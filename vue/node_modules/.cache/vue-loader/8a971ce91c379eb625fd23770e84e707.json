{"remainingRequest":"/Users/mia/Documents/wxypwebapp/vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mia/Documents/wxypwebapp/vue/src/components/rate/Upload.vue?vue&type=style&index=0&id=bd9b7f60&lang=less&scoped=true&","dependencies":[{"path":"/Users/mia/Documents/wxypwebapp/vue/src/components/rate/Upload.vue","mtime":1554103443657},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/less-loader/dist/cjs.js","mtime":1554269486971},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#imgUploader {\n    flex: 1;\n    margin-top: auto;\n    background: #f7f7f7;\n    padding: 10px 0;\n    .file-list {\n        .file-remove {\n            position: absolute;\n            font-size: 12px;\n            right: -5px;\n            top: -5px;\n            width: 14px;\n            height: 14px;\n            color: white;\n            cursor: pointer;\n            line-height: 14px;\n            background: rgba(0, 0, 0, 05);\n            border-radius: 3px;\n            z-index: 1000;\n            text-align: center;\n        }\n\n        &:hover .file-remove {\n            display: inline;\n        }\n    }\n}\n.add {\n    width: 100%;\n    height: 50px;\n    float: left;\n    text-align: center;\n    line-height: 50px;\n    // font-size: 1.4rem;\n    font-weight: 100;\n    cursor: pointer;\n    border: 1px dashed #ccc;\n    color: #999;\n    position: relative;\n    // background: #f2f2f2;\n    @media screen and(min-width:768px) and(max-width:1024px) {\n        height: 180px;\n        line-height: 180px;\n        font-size: 56px;\n    }\n    .fa {\n        font-size: 1.4em;\n        color: #7dd2d9;\n    }\n}\n.uploadBtn {\n    position: relative;\n    .empty {\n        position: absolute;\n        right: 0;\n        bottom: 0;\n        background-color: #eee;\n        color: #fff;\n        padding: 0.2em 1em;\n    }\n}\n\n.thumbnails {\n    margin: 0;\n    width: 90%;\n    margin: 0 auto;\n    background: #f7f7f7;\n    display: -webkit-box;\n    display: -webkit-flex;\n    display: -ms-flexbox;\n    display: flex;\n    .thumbnail {\n        position: relative;\n        width: 50px;\n        box-sizing: border-box;\n        height: 50px;\n        margin-right: 10px;\n        .img-wrapper {\n            position: relative;\n            display: flex;\n            height: 50px;\n            img {\n                width: auto;\n                height: auto;\n                width: 100%;\n                max-width: 100%;\n                max-height: 100%;\n                object-fit: cover;\n            }\n        }\n    }\n}\ninput[type=\"file\"] {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 50px;\n    opacity: 0;\n}\n",{"version":3,"sources":["Upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Upload.vue","sourceRoot":"src/components/rate","sourcesContent":["\n<!--\nDescription 图片上传及预览组件\n@authors Benny\n@date    2018-05-08 12:57:08\n@version 1.0.0\n-->\n<template>\n    <div id=\"imgUploader\">\n        <div class=\"file-list\">\n            <div class=\"thumbnails my-gallery\">\n                <figure\n                    itemprop=\"associatedMedia\"\n                    itemscope\n                    class=\"thumbnail\"\n                    v-for=\"(item,index) in files\"\n                    :key=\"index\"\n                >\n                    <a\n                        :href=\"item.src\"\n                        itemprop=\"contentUrl\"\n                        data-size=\"400x400\"\n                        class=\"img-wrapper\"\n                    >\n                        <img :src=\"item.src\" itemprop=\"thumbnail\">\n                    </a>\n                    <span class=\"file-remove\" @click=\"remove(index,$event)\">×</span>\n                </figure>\n                <section class=\"thumbnail\" v-if=\"this.files.length < 5\">\n                    <div class=\"add\">\n                        <span>+</span>\n                        <input\n                            type=\"file\"\n                            @change=\"selectImgs()\"\n                            multiple\n                            accept=\"image/*\"\n                            ref=\"file\"\n                        >\n                    </div>\n                </section>\n            </div>\n\n            <!-- PhotoSwipe插件需要的元素， 一定要有类名 pswp -->\n            <div class=\"pswp\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">\n                <div class=\"pswp__bg\"></div>\n                <div class=\"pswp__scroll-wrap\">\n                    <div class=\"pswp__container\">\n                        <div class=\"pswp__item\"></div>\n                        <div class=\"pswp__item\"></div>\n                        <div class=\"pswp__item\"></div>\n                    </div>\n                    <!-- 预览区域顶部的默认UI，可以修改 -->\n                    <div class=\"pswp__ui pswp__ui--hidden\">\n                        <div class=\"pswp__top-bar\">\n                            <!--  与图片相关的操作 -->\n                            <div class=\"pswp__counter\"></div>\n                            <button class=\"pswp__button pswp__button--close\" title=\"Close (Esc)\"></button>\n                            <!--将分享按钮去掉 -->\n                            <div class=\"pswp__preloader\">\n                                <div class=\"pswp__preloader__icn\">\n                                    <div class=\"pswp__preloader__cut\">\n                                        <div class=\"pswp__preloader__donut\"></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"pswp__share-modal pswp__share-modal--hidden pswp__single-tap\">\n                            <div class=\"pswp__share-tooltip\"></div>\n                        </div>\n                        <button\n                            class=\"pswp__button pswp__button--arrow--left\"\n                            title=\"Previous (arrow left)\"\n                        ></button>\n                        <button\n                            class=\"pswp__button pswp__button--arrow--right\"\n                            title=\"Next (arrow right)\"\n                        ></button>\n                        <div class=\"pswp__caption\">\n                            <div class=\"pswp__caption__center\"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nimport PhotoSwipe from \"photoswipe\";\nimport PhotoSwipeUI_Default from \"photoswipe/dist/photoswipe-ui-default\";\nimport \"photoswipe/dist/photoswipe.css\";\nimport \"photoswipe/dist/default-skin/default-skin.css\";\nexport default {\n    data() {\n        return {\n            // lang: this.$lang(\"dynamic\"),\n            files: [], // 文件缓存\n            index: 0, // 序列号\n            maxLength: 5, // 图片最大数量\n            maxSize: 10240000 //图片限制为10M内\n        };\n    },\n    methods: {\n        //选择图片\n        selectImgs() {\n            let fileList = this.$refs.file.files;\n            if (fileList.length > this.maxLength) {\n                this.$toast(\"最大选择图片不能超过5张\");\n            }\n            let tempList = []; //每次点击+号后选择的图片信息\n            for (let i = 0, len = fileList.length; i < len; i++) {\n                let fileItem = {\n                    Id: this.index++,\n                    name: fileList[i].name,\n                    size: fileList[i].size,\n                    file: fileList[i]\n                };\n                //将图片文件转成Base64\n                let reader = new FileReader();\n                reader.onloadend = e => {\n                    this.getBase64(e.target.result).then(url => {\n                        this.$set(fileItem, \"src\", url);\n                    });\n                };\n                if (fileItem.size > this.maxSize) {\n                    Toast(this.lang.dynamic_over_size);\n                } else {\n                    reader.readAsDataURL(fileList[i]);\n                    tempList.push(fileItem)\n                    this.files.push(fileItem);\n                }\n            }\n\n            this.files.splice(5);\n            tempList.splice(5)\n            setTimeout(() => {\n                this.$emit(\"getFiles\", tempList);\n            }, 300);\n        },\n\n        clearFiles() {\n            this.files = []\n        },\n        \n        // 图片压缩并保存到files\n        getBase64(url) {\n            let self = this;\n            let Img = new Image(),\n                dataURL = \"\";\n            Img.src = url;\n            let p = new Promise(function(resolve, reject) {\n                Img.onload = function() {\n                    //要先确保图片完整获取到，这是个异步事件\n                    let canvas = document.createElement(\"canvas\"), //创建canvas元素\n                        width = Img.width, //确保canvas的尺寸和图片一样\n                        height = Img.height;\n                    // 默认将长宽设置为图片的原始长宽，这样在长宽不超过最大长度时就不需要再处理\n                    let ratio = width / height,\n                        maxLength = 1000,\n                        newHeight = height,\n                        newWidth = width;\n                    // 在长宽超过最大长度时，按图片长宽比例等比缩小\n                    if (width > maxLength || height > maxLength) {\n                        if (width > height) {\n                            newWidth = maxLength;\n                            newHeight = maxLength / ratio;\n                        } else {\n                            newWidth = maxLength * ratio;\n                            newHeight = maxLength;\n                        }\n                    }\n                    canvas.width = newWidth;\n                    canvas.height = newHeight;\n                    canvas\n                        .getContext(\"2d\")\n                        .drawImage(Img, 0, 0, newWidth, newHeight); //将图片绘制到canvas中\n                    dataURL = canvas.toDataURL(\"image/jpeg\", 0.5); //转换图片为dataURL\n                    resolve(dataURL);\n                };\n            });\n            return p;\n        },\n        // 移除图片\n        remove(index, e) {\n            e.stopPropagation(); //阻止\n            this.files.splice(index, 1);\n            setTimeout(() => {\n                this.$emit(\"removeFiles\", index);\n            }, 300);\n        },\n        //引入photoSwipe(可预览、滑动)\n        initPhotoSwipeFromDOM(gallerySelector) {\n            var parseThumbnailElements = function(el) {\n                var thumbElements = el.childNodes,\n                    numNodes = thumbElements.length,\n                    items = [],\n                    figureEl,\n                    linkEl,\n                    size,\n                    item;\n                for (var i = 0; i < numNodes - 1; i++) {\n                    figureEl = thumbElements[i];\n                    if (figureEl.nodeType !== 1) {\n                        continue;\n                    }\n                    linkEl = figureEl.children[0];\n                    var img = new Image();\n                    img.src = linkEl.getAttribute(\"href\");\n                    linkEl.setAttribute(\n                        \"data-size\",\n                        img.naturalWidth + \"x\" + img.naturalHeight\n                    );\n                    size = linkEl.getAttribute(\"data-size\").split(\"x\");\n                    item = {\n                        src: linkEl.getAttribute(\"href\"),\n                        w: parseInt(size[0], 10),\n                        h: parseInt(size[1], 10)\n                    };\n                    if (figureEl.children.length > 1) {\n                        item.title = figureEl.children[1].innerHTML;\n                    }\n                    if (linkEl.children.length > 0) {\n                        item.msrc = linkEl.children[0].getAttribute(\"src\");\n                    }\n                    item.el = figureEl;\n                    items.push(item);\n                }\n                return items;\n            };\n            var closest = function closest(el, fn) {\n                return el && (fn(el) ? el : closest(el.parentNode, fn));\n            };\n            var onThumbnailsClick = function(e) {\n                e = e || window.event;\n                // e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n                var eTarget = e.target || e.srcElement;\n                var clickedListItem = closest(eTarget, function(el, e) {\n                    return el.tagName && el.tagName.toUpperCase() === \"FIGURE\";\n                });\n\n                if (!clickedListItem) {\n                    return;\n                }\n                var clickedGallery = clickedListItem.parentNode,\n                    childNodes = clickedListItem.parentNode.childNodes,\n                    numChildNodes = childNodes.length,\n                    nodeIndex = 0,\n                    index;\n                for (var i = 0; i < numChildNodes; i++) {\n                    if (childNodes[i].nodeType !== 1) {\n                        continue;\n                    }\n                    if (childNodes[i] === clickedListItem) {\n                        index = nodeIndex;\n                        break;\n                    }\n                    nodeIndex++;\n                }\n\n                if (index >= 0) {\n                    openPhotoSwipe(index, clickedGallery);\n                }\n                return false;\n            };\n            var photoswipeParseHash = function() {\n                var hash = window.location.hash.substring(1),\n                    params = {};\n                if (hash.length < 5) {\n                    return params;\n                }\n                var vars = hash.split(\"&\");\n                for (var i = 0; i < vars.length; i++) {\n                    if (!vars[i]) {\n                        continue;\n                    }\n                    var pair = vars[i].split(\"=\");\n                    if (pair.length < 2) {\n                        continue;\n                    }\n                    params[pair[0]] = pair[1];\n                }\n                if (params.gid) {\n                    params.gid = parseInt(params.gid, 10);\n                }\n                return params;\n            };\n\n            var openPhotoSwipe = function(\n                index,\n                galleryElement,\n                disableAnimation,\n                fromURL\n            ) {\n                var pswpElement = document.querySelectorAll(\".pswp\")[0],\n                    gallery,\n                    options,\n                    items;\n                items = parseThumbnailElements(galleryElement);\n                options = {\n                    history: false,\n                    tapToClose: true,\n                    galleryUID: galleryElement.getAttribute(\"data-pswp-uid\"),\n                    getThumbBoundsFn: function(index) {\n                        var thumbnail = items[index].el.getElementsByTagName(\n                                \"img\"\n                            )[0],\n                            pageYScroll =\n                                window.pageYOffset ||\n                                document.documentElement.scrollTop,\n                            rect = thumbnail.getBoundingClientRect();\n                        return {\n                            x: rect.left,\n                            y: rect.top + pageYScroll,\n                            w: rect.width\n                        };\n                    }\n                };\n                if (fromURL) {\n                    if (options.galleryPIDs) {\n                        for (var j = 0; j < items.length; j++) {\n                            if (items[j].pid == index) {\n                                options.index = j;\n                                break;\n                            }\n                        }\n                    } else {\n                        options.index = parseInt(index, 10) - 1;\n                    }\n                } else {\n                    options.index = parseInt(index, 10);\n                }\n                if (isNaN(options.index)) {\n                    return \"\";\n                }\n                if (disableAnimation) {\n                    options.showAnimationDuration = 0;\n                }\n\n                gallery = new PhotoSwipe(\n                    pswpElement,\n                    PhotoSwipeUI_Default,\n                    items,\n                    options\n                );\n                gallery.init();\n            };\n            var galleryElements = document.querySelectorAll(gallerySelector);\n            for (var i = 0, l = galleryElements.length; i < l; i++) {\n                galleryElements[i].setAttribute(\"data-pswp-uid\", i + 1);\n                galleryElements[i].onclick = onThumbnailsClick;\n            }\n            var hashData = photoswipeParseHash();\n            if (hashData.pid && hashData.gid) {\n                openPhotoSwipe(\n                    hashData.pid,\n                    galleryElements[hashData.gid - 1],\n                    true,\n                    true\n                );\n            }\n        }\n    },\n    mounted() {\n        this.initPhotoSwipeFromDOM(\".my-gallery\");\n    }\n};\n</script>\n\n<style lang=\"less\" scoped>\n#imgUploader {\n    flex: 1;\n    margin-top: auto;\n    background: #f7f7f7;\n    padding: 10px 0;\n    .file-list {\n        .file-remove {\n            position: absolute;\n            font-size: 12px;\n            right: -5px;\n            top: -5px;\n            width: 14px;\n            height: 14px;\n            color: white;\n            cursor: pointer;\n            line-height: 14px;\n            background: rgba(0, 0, 0, 05);\n            border-radius: 3px;\n            z-index: 1000;\n            text-align: center;\n        }\n\n        &:hover .file-remove {\n            display: inline;\n        }\n    }\n}\n.add {\n    width: 100%;\n    height: 50px;\n    float: left;\n    text-align: center;\n    line-height: 50px;\n    // font-size: 1.4rem;\n    font-weight: 100;\n    cursor: pointer;\n    border: 1px dashed #ccc;\n    color: #999;\n    position: relative;\n    // background: #f2f2f2;\n    @media screen and(min-width:768px) and(max-width:1024px) {\n        height: 180px;\n        line-height: 180px;\n        font-size: 56px;\n    }\n    .fa {\n        font-size: 1.4em;\n        color: #7dd2d9;\n    }\n}\n.uploadBtn {\n    position: relative;\n    .empty {\n        position: absolute;\n        right: 0;\n        bottom: 0;\n        background-color: #eee;\n        color: #fff;\n        padding: 0.2em 1em;\n    }\n}\n\n.thumbnails {\n    margin: 0;\n    width: 90%;\n    margin: 0 auto;\n    background: #f7f7f7;\n    display: -webkit-box;\n    display: -webkit-flex;\n    display: -ms-flexbox;\n    display: flex;\n    .thumbnail {\n        position: relative;\n        width: 50px;\n        box-sizing: border-box;\n        height: 50px;\n        margin-right: 10px;\n        .img-wrapper {\n            position: relative;\n            display: flex;\n            height: 50px;\n            img {\n                width: auto;\n                height: auto;\n                width: 100%;\n                max-width: 100%;\n                max-height: 100%;\n                object-fit: cover;\n            }\n        }\n    }\n}\ninput[type=\"file\"] {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 50px;\n    opacity: 0;\n}\n</style>\n"]}]}
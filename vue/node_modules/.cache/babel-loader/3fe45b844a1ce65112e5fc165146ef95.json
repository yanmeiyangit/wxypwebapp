{"remainingRequest":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_babel-loader@8.0.5@babel-loader/lib/index.js!/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js??vue-loader-options!/Users/mia/Documents/wxypapp/Vue-shopping/vue/src/views/ShoppingPayMent.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/src/views/ShoppingPayMent.vue","mtime":1554103443665},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_babel-loader@8.0.5@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport GoodsList from 'public/GoodsList';\nimport { vuexData } from 'js/mixin';\nimport Scroll from 'public/Scroll';\nexport default {\n  name: \"ShoppingPayMent\",\n  mixins: [vuexData],\n  components: {\n    GoodsList: GoodsList,\n    Scroll: Scroll\n  },\n  beforeRouteEnter: function beforeRouteEnter(to, from, next) {\n    next(function (vm) {\n      vm.getDefaultAddress();\n\n      if (!vm.shopOrderList.length) {\n        vm.$router.push({\n          name: 'ShoppingCart'\n        });\n      }\n    });\n  },\n  computed: {\n    price: function price() {\n      var num = 0;\n\n      if (this.shopOrderList.length) {\n        this.shopOrderList.forEach(function (item) {\n          num += item.present_price * item.count;\n        });\n        return Number(num.toFixed(2) * 100);\n      }\n    }\n  },\n  data: function data() {\n    return {\n      caitiao: require('img/caitiao.jpg'),\n      isLoading: false,\n      list: [],\n      defaultAdd: ''\n    };\n  },\n  methods: {\n    // 查询默认收货地址\n    getDefaultAddress: function () {\n      var _getDefaultAddress = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var _ref, data;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return this.Api.getDefaultAddress();\n\n              case 3:\n                _ref = _context.sent;\n                data = _ref.data;\n\n                if (data.code == 200) {\n                  this.defaultAdd = data.defaultAdd;\n                }\n\n                _context.next = 11;\n                break;\n\n              case 8:\n                _context.prev = 8;\n                _context.t0 = _context[\"catch\"](0);\n                this.$toast('网络错误');\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 8]]);\n      }));\n\n      function getDefaultAddress() {\n        return _getDefaultAddress.apply(this, arguments);\n      }\n\n      return getDefaultAddress;\n    }(),\n    goBack: function goBack() {\n      var _this = this;\n\n      this.$router.go(-1);\n      setTimeout(function () {\n        _this.setShopList([]);\n\n        _this.setVuexAddress('');\n      }, 300);\n    },\n    onSubmit: function () {\n      var _onSubmit = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var _this2 = this;\n\n        var Addressid, orderId, _ref2, data;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(!this.defaultAdd || !this.defaultAdd._id && (!this.temporaryAddress || !this.temporaryAddress._id))) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                this.$toast('请添加收获地址');\n                return _context2.abrupt(\"return\");\n\n              case 3:\n                this.isLoading = true; // 传地址id，订单id，和总价格\n\n                Addressid = 123456745;\n                orderId = [];\n                console.log(this.shopOrderList);\n                this.shopOrderList.forEach(function (item) {\n                  orderId.push(item.cid);\n                });\n                _context2.prev = 8;\n                _context2.next = 11;\n                return this.Api.placeOrder({\n                  address: this.temporaryAddress.address || this.defaultAdd.address,\n                  tel: this.temporaryAddress.tel || this.defaultAdd.tel,\n                  orderId: orderId,\n                  totalPrice: (this.price / 100).toFixed(2),\n                  idDirect: this.shopOrderList[0].idDirect,\n                  count: this.shopOrderList[0].count\n                });\n\n              case 11:\n                _ref2 = _context2.sent;\n                data = _ref2.data;\n\n                if (data.code == 200) {\n                  this.isLoading = false;\n                  this.$toast(data.msg);\n                  setTimeout(function () {\n                    _this2.setShopList([]);\n\n                    _this2.$router.push({\n                      path: '/'\n                    }); // location.href = '/'\n\n                  }, 2000);\n                }\n\n                _context2.next = 20;\n                break;\n\n              case 16:\n                _context2.prev = 16;\n                _context2.t0 = _context2[\"catch\"](8);\n                this.isLoading = false;\n                this.$toast('网络错误');\n\n              case 20:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[8, 16]]);\n      }));\n\n      function onSubmit() {\n        return _onSubmit.apply(this, arguments);\n      }\n\n      return onSubmit;\n    }(),\n    // 添加收货地址\n    goAddress: function goAddress() {\n      this.$router.push({\n        name: 'Address'\n      });\n    },\n    // 选择地址\n    editAddress: function editAddress() {\n      this.$router.push({\n        name: 'Address'\n      });\n    }\n  }\n};",{"version":3,"sources":["ShoppingPayMent.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <!-- 订单结算和选择商品页面 -->\n    <div class=\"order\">\n        <van-nav-bar\n                title=\"订单结算\"\n                left-arrow\n                @click-left=\"goBack\"\n        />\n                <div class=\"address-warp\">\n                    <div class=\"address addnull\" v-if=\"!defaultAdd || !defaultAdd._id && (!temporaryAddress || !temporaryAddress._id)\" @click=\"goAddress\">\n                        点击添加收获地址\n                    </div>\n                    <div class=\"address\" v-else @click=\"editAddress\">\n                        <div class=\"icon\"><van-icon name=\"location\" class=\"location\"/></div>\n                        <div class=\"address-cont\">\n                            <p class=\"name\">收货人: {{temporaryAddress.name || defaultAdd.name}} <span>{{temporaryAddress.tel || defaultAdd.tel}}</span></p>\n                            <p class=\"address-e\">收货地址: {{temporaryAddress.address || defaultAdd.address}}</p>\n                            <p class=\"no\">(收货不便时,可选择免费待收货服务)</p>\n                        </div>\n                        <div class=\"icon2\"><van-icon name=\"arrow\" class=\"location\"/></div>\n                    </div>\n                    <img :src=\"caitiao\" width=\"100%\" height=\"3px\" alt=\"\" class=\"caitiao\">\n                <Scroll :data='shopOrderList' ref=\"scroll\" class=\"scroll\">\n                    <div class=\"goods-list\">\n                        <GoodsList :list='shopOrderList' :isOrder='true'/>\n                    </div>\n                </Scroll>\n            </div>\n        \n        <div v-if=\"shopOrderList && shopOrderList.length\">\n            <van-submit-bar\n                :loading='isLoading'\n                :price=\"price\"\n                button-text=\"提交订单\"\n                @submit=\"onSubmit\"\n            />\n        </div>\n    </div>\n</template>\n\n<script>\nimport GoodsList from 'public/GoodsList'\nimport {vuexData} from 'js/mixin'\nimport Scroll from 'public/Scroll'\nexport default {\n    name: \"ShoppingPayMent\",\n    mixins:[vuexData],\n    components: {\n        GoodsList,\n        Scroll,\n    },\n\n    beforeRouteEnter (to, from, next) {\n        next(vm => {\n            vm.getDefaultAddress()\n            if (!vm.shopOrderList.length) {\n                vm.$router.push({name:'ShoppingCart'})\n                \n            }\n        })\n        \n    },\n    computed: {\n        price() {\n            let num = 0\n            if (this.shopOrderList.length) {\n                    this.shopOrderList.forEach( item => {\n                    num += item.present_price * item.count\n                })\n                return Number( num.toFixed(2) * 100)\n            }\n        }\n    },\n\n    data() {\n        return {\n            caitiao: require('img/caitiao.jpg'),\n            isLoading: false,\n            list: [],\n            defaultAdd:''\n        }\n    },\n\n\n    methods: {\n        // 查询默认收货地址\n        async getDefaultAddress() {\n            try {\n                const {data} = await this.Api.getDefaultAddress()\n                if (data.code == 200) {\n                    this.defaultAdd = data.defaultAdd\n                }\n            } catch (error) {\n                this.$toast('网络错误')\n            }\n            \n        },\n\n        goBack() {\n            this.$router.go(-1)\n            setTimeout(() => {\n                this.setShopList([])\n                this.setVuexAddress('')\n            }, 300);\n        },\n\n        async onSubmit() {\n            if (!this.defaultAdd || !this.defaultAdd._id && (!this.temporaryAddress || !this.temporaryAddress._id)) {\n                this.$toast('请添加收获地址')\n                return\n            }\n            this.isLoading = true\n            // 传地址id，订单id，和总价格\n            let Addressid = 123456745;\n            let orderId = []\n            console.log(this.shopOrderList);\n            \n            this.shopOrderList.forEach( item => {\n                orderId.push(item.cid)\n            })\n            \n            try {\n                const { data } = await this.Api.placeOrder({\n                    address:  this.temporaryAddress.address || this.defaultAdd.address,\n                    tel: this.temporaryAddress.tel || this.defaultAdd.tel,\n                    orderId,\n                    totalPrice: (this.price / 100).toFixed(2),\n                    idDirect: this.shopOrderList[0].idDirect,\n                    count: this.shopOrderList[0].count\n                })\n                if (data.code == 200) {\n                    this.isLoading = false\n                    this.$toast(data.msg)\n                    setTimeout(() => {\n                        this.setShopList([])\n                        this.$router.push({path: '/'})\n                        // location.href = '/'\n                    }, 2000);\n                }\n            } catch (err) {\n                this.isLoading = false\n                this.$toast('网络错误')\n            }\n        },\n\n\n        // 添加收货地址\n        goAddress() {\n            this.$router.push({name: 'Address'})\n        },\n\n        // 选择地址\n        editAddress() {\n            this.$router.push({name:'Address'})\n        }\n    }\n}\n</script>\n\n<style lang=\"stylus\" scoped>\n.order\n    position fixed\n    top 0px\n    left 0\n    right 0\n    bottom 0px\n    z-index 500\n    background #fff\n    .scroll\n        position fixed\n        top 148px\n        bottom 50px\n        left 0\n        right 0\n        overflow hidden\n    .address-warp\n        .caitiao\n            margin-top -10px\n        .addnull\n            align-items center\n            padding 0!important   \n            justify-content center\n            font-size 14px\n        .address\n            display flex\n            height 90px\n            padding 10px\n            padding-bottom 0\n            background #fff\n            .icon\n                flex 0 0 30px \n                width 30px\n                align-self center\n                margin-right 8px\n                .location\n                    font-size 24px\n            .address-cont\n                flex 1\n                display flex\n                flex-direction column\n                justify-content space-around    \n                .name\n                    font-size 15px\n                    span \n                        float right \n                        margin-right 10px\n                .address-e\n                    font-size 12px\n                    margin-right 5px\n                    line-height 1.4       \n                .no\n                    color #F9CC9D\n                    font-size 12px     \n                    letter-spacing 1px\n                    margin-top -5px\n            .icon2\n                flex 0 0 10px\n                align-self center \n        .goods-list\n            background #fff                   \n</style>\n"],"sourceRoot":"src/views"}]}
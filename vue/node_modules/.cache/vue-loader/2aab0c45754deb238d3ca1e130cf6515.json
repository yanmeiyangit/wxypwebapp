{"remainingRequest":"/Users/mia/Documents/wxypwebapp/vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mia/Documents/wxypwebapp/vue/src/components/my/UserInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mia/Documents/wxypwebapp/vue/src/components/my/UserInfo.vue","mtime":1554280626430},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Cropper from \"@/components/my/Cropper\";\nimport { goBack, vuexData } from \"js/mixin\";\n\nexport default {\n    mixins: [vuexData],\n    components: {\n        Cropper\n    },\n    data() {\n        return {\n            show: false,\n            loading: false,\n            defaultImg: 'this.src=\"' + require(\"img/vue.jpg\") + '\"',\n            imgStyle: {\n                width: \"55px\",\n                height: \"55px\",\n                \"border-radius\": \"50%\",\n                display: \"none\"\n            },\n            nickname: \"\",\n            username: \"\",\n            tempAvatar: \"\", //裁剪的临时图片\n            showBirth: false,\n            showGender: false,\n            year: \"\",\n            month: \"\",\n            day: \"\",\n            gender: \"男\",\n            email: \"\",\n            currentDate: new Date(),\n            columns: [\"男\", \"女\", \"保密\"],\n            maxDate: new Date(),\n            minDate: new Date(1937, 12, 31),\n            birth: \"\" // ,出生年月\n        };\n    },\n    mounted() {\n        \n    },\n    methods: {\n        showPop() {\n            this.show = true\n            this.setting()\n        },\n        goBack() {\n            this.show = false;\n            setTimeout(() => {\n                this.tempAvatar = \"\";\n            }, 300);\n        },\n        github() {\n            window.open(\"https://github.com/yanmeiyangit/wxypwebapp\", \"_blank\");\n        },\n        callback(img) {\n            this.tempAvatar = img;\n        },\n        noName() {\n            this.$toast(\"用户名暂时不能修改哟~~\");\n        },\n        // 修改用户资料\n        async setting() {\n            try {\n                const { data } = await this.Api.user();\n                if (data.code == 200) {\n                    this.username = data.userInfo.username;\n                    this.gender = data.userInfo.gender;\n                    this.birth =\n                        data.userInfo.year +\n                        \"年\" +\n                        data.userInfo.month +\n                        \"月\" +\n                        data.userInfo.day +\n                        \"日\";\n                    this.year = data.userInfo.year;\n                    this.month = data.userInfo.month;\n                    this.day = data.userInfo.day;\n                    this.email = data.userInfo.email;\n                    this.id = data.userInfo._id;\n                    this.nickname = data.userInfo.nickname;\n                }\n            } catch (error) {\n                this.$toast(\"获取用户信息失败\");\n            }\n        },\n        confirm(val) {\n            let d = new Date(val);\n            this.year = d.getFullYear();\n            this.month = d.getMonth() + 1;\n            this.day = d.getDate();\n            this.birth = this.year + \"年\" + this.month + \"月\" + this.day + \"日\";\n            this.showBirth = false;\n        },\n\n        onChange(picker, value) {\n            this.gender = value;\n        },\n        // 保存\n        async post() {\n            this.loading = true;\n            let datas = {\n                gender: this.gender,\n                email: this.email,\n                year: this.year,\n                month: this.month,\n                day: this.day,\n                id: this.id,\n                nickname: this.nickname,\n                avatar: this.tempAvatar ? this.tempAvatar : undefined\n            };\n            try {\n                const { data } = await this.Api.saveUser(datas);\n                if (data.code == 200) {\n                    this.loading = false;\n                    this.setName(data.user);\n                    this.$toast(data.msg);\n                } else {\n                    this.$toast(data.msg);\n                    this.loading = false;\n                }\n            } catch (error) {\n                this.loading = false;\n                this.$toast(\"修改失败,网络错误\");\n            }\n        }\n    }\n};\n",{"version":3,"sources":["UserInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqFA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UserInfo.vue","sourceRoot":"src/components/my","sourcesContent":["<template>\n    <van-popup v-model=\"show\" position=\"right\" class=\"popup\" :overlay=\"false\">\n        <van-nav-bar title=\"个人资料\" left-arrow @click-left=\"goBack\"/>\n        <van-cell-group>\n            <p @click=\"github\">\n                <van-field\n                    class=\"border-bottom\"\n                    value=\"https://github.com/yanmeiyangit/wxypwebapp\"\n                    disabled\n                    clearable\n                    label=\"github\"\n                />\n            </p>\n            <div id=\"setAvatar\" class=\"set-avatar border-bottom\">\n                <span>头像</span>\n                <div>\n                    <img\n                        v-if=\"userName\"\n                        :onerror=\"defaultImg\"\n                        :src=\"tempAvatar || userName.avatar\"\n                        alt\n                        srcset\n                    >\n                    <van-icon name=\"arrow\"/>\n                </div>\n                <div class=\"cropper\">\n                    <Cropper :imgStyle=\"imgStyle\" @callback=\"callback\"/>\n                </div>\n            </div>\n            <p @click=\"noName\">\n                <van-field class=\"border-bottom\" v-model=\"username\" disabled clearable label=\"用户名\"/>\n            </p>\n\n            <van-field v-model=\"nickname\" clearable label=\"昵称\" placeholder=\"请输入昵称\"/>\n            <p @click=\"showGender=true\" class=\"gender\">\n                <van-field\n                    class=\"border-bottom\"\n                    v-model=\"gender\"\n                    clearable\n                    disabled\n                    label=\"性别\"\n                    placeholder=\"男\"\n                />\n            </p>\n\n            <van-field v-model=\"email\" clearable label=\"邮箱\" placeholder=\"请输入邮箱\"/>\n            <p @click=\"showBirth = true;\" class=\"birth\">\n                <van-field v-model=\"birth\" clearable disabled label=\"出生年月\" placeholder=\"出生年月\"/>\n            </p>\n        </van-cell-group>\n        <van-popup v-model=\"showBirth\" position=\"bottom\" :overlay=\"true\">\n            <van-datetime-picker\n                v-model=\"currentDate\"\n                type=\"date\"\n                :min-date=\"minDate\"\n                :max-date=\"maxDate\"\n                @confirm=\"confirm\"\n                @cancel=\"showBirth = false\"\n            />\n        </van-popup>\n        <van-popup v-model=\"showGender\" position=\"bottom\" :overlay=\"true\">\n            <van-picker\n                class=\"gender-picker\"\n                :columns=\"columns\"\n                @change=\"onChange\"\n                show-toolbar\n                title=\"性别\"\n                @cancel=\"showGender=false\"\n                @confirm=\"showGender=false\"\n            />\n        </van-popup>\n        <div class=\"normal\">\n            <van-button\n                size=\"normal\"\n                class=\"normal-btn\"\n                type=\"primary\"\n                @click=\"post\"\n                :loading=\"loading\"\n            >保存</van-button>\n            <van-button @click=\"show=false\" size=\"normal\" class=\"normal-btn normal-btn-default\">取消</van-button>\n        </div>\n    </van-popup>\n</template>\n\n<script>\nimport Cropper from \"@/components/my/Cropper\";\nimport { goBack, vuexData } from \"js/mixin\";\n\nexport default {\n    mixins: [vuexData],\n    components: {\n        Cropper\n    },\n    data() {\n        return {\n            show: false,\n            loading: false,\n            defaultImg: 'this.src=\"' + require(\"img/vue.jpg\") + '\"',\n            imgStyle: {\n                width: \"55px\",\n                height: \"55px\",\n                \"border-radius\": \"50%\",\n                display: \"none\"\n            },\n            nickname: \"\",\n            username: \"\",\n            tempAvatar: \"\", //裁剪的临时图片\n            showBirth: false,\n            showGender: false,\n            year: \"\",\n            month: \"\",\n            day: \"\",\n            gender: \"男\",\n            email: \"\",\n            currentDate: new Date(),\n            columns: [\"男\", \"女\", \"保密\"],\n            maxDate: new Date(),\n            minDate: new Date(1937, 12, 31),\n            birth: \"\" // ,出生年月\n        };\n    },\n    mounted() {\n        \n    },\n    methods: {\n        showPop() {\n            this.show = true\n            this.setting()\n        },\n        goBack() {\n            this.show = false;\n            setTimeout(() => {\n                this.tempAvatar = \"\";\n            }, 300);\n        },\n        github() {\n            window.open(\"https://github.com/yanmeiyangit/wxypwebapp\", \"_blank\");\n        },\n        callback(img) {\n            this.tempAvatar = img;\n        },\n        noName() {\n            this.$toast(\"用户名暂时不能修改哟~~\");\n        },\n        // 修改用户资料\n        async setting() {\n            try {\n                const { data } = await this.Api.user();\n                if (data.code == 200) {\n                    this.username = data.userInfo.username;\n                    this.gender = data.userInfo.gender;\n                    this.birth =\n                        data.userInfo.year +\n                        \"年\" +\n                        data.userInfo.month +\n                        \"月\" +\n                        data.userInfo.day +\n                        \"日\";\n                    this.year = data.userInfo.year;\n                    this.month = data.userInfo.month;\n                    this.day = data.userInfo.day;\n                    this.email = data.userInfo.email;\n                    this.id = data.userInfo._id;\n                    this.nickname = data.userInfo.nickname;\n                }\n            } catch (error) {\n                this.$toast(\"获取用户信息失败\");\n            }\n        },\n        confirm(val) {\n            let d = new Date(val);\n            this.year = d.getFullYear();\n            this.month = d.getMonth() + 1;\n            this.day = d.getDate();\n            this.birth = this.year + \"年\" + this.month + \"月\" + this.day + \"日\";\n            this.showBirth = false;\n        },\n\n        onChange(picker, value) {\n            this.gender = value;\n        },\n        // 保存\n        async post() {\n            this.loading = true;\n            let datas = {\n                gender: this.gender,\n                email: this.email,\n                year: this.year,\n                month: this.month,\n                day: this.day,\n                id: this.id,\n                nickname: this.nickname,\n                avatar: this.tempAvatar ? this.tempAvatar : undefined\n            };\n            try {\n                const { data } = await this.Api.saveUser(datas);\n                if (data.code == 200) {\n                    this.loading = false;\n                    this.setName(data.user);\n                    this.$toast(data.msg);\n                } else {\n                    this.$toast(data.msg);\n                    this.loading = false;\n                }\n            } catch (error) {\n                this.loading = false;\n                this.$toast(\"修改失败,网络错误\");\n            }\n        }\n    }\n};\n</script>\n\n<style scoped lang='less'>\n.popup {\n    height: 100%;\n    width: 100%;\n    background: #fff;\n}\n.normal {\n    margin-top: 50px;\n    text-align: center;\n}\n.normal-btn {\n    width: 80%;\n}\n.normal-btn-default {\n    margin-top: 10px;\n}\n.cropper {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n}\n.set-avatar {\n    height: 80px;\n    line-height: 80px;\n    display: flex;\n    padding: 0 15px;\n    position: relative;\n    span {\n        flex: 0 0 75%;\n    }\n    div {\n        flex: 1;\n        img {\n            width: 55px;\n            height: 55px;\n            border-radius: 50%;\n            margin-right: 5px;\n        }\n    }\n}\n</style>\n\n"]}]}
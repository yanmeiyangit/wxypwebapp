{"remainingRequest":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_babel-loader@8.0.5@babel-loader/lib/index.js!/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js??vue-loader-options!/Users/mia/Documents/wxypapp/Vue-shopping/vue/src/components/rate/Upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/src/components/rate/Upload.vue","mtime":1554103443657},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_babel-loader@8.0.5@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport PhotoSwipe from \"photoswipe\";\nimport PhotoSwipeUI_Default from \"photoswipe/dist/photoswipe-ui-default\";\nimport \"photoswipe/dist/photoswipe.css\";\nimport \"photoswipe/dist/default-skin/default-skin.css\";\nexport default {\n  data: function data() {\n    return {\n      // lang: this.$lang(\"dynamic\"),\n      files: [],\n      // 文件缓存\n      index: 0,\n      // 序列号\n      maxLength: 5,\n      // 图片最大数量\n      maxSize: 10240000 //图片限制为10M内\n\n    };\n  },\n  methods: {\n    //选择图片\n    selectImgs: function selectImgs() {\n      var _this = this;\n\n      var fileList = this.$refs.file.files;\n\n      if (fileList.length > this.maxLength) {\n        this.$toast(\"最大选择图片不能超过5张\");\n      }\n\n      var tempList = []; //每次点击+号后选择的图片信息\n\n      var _loop = function _loop(i, len) {\n        var fileItem = {\n          Id: _this.index++,\n          name: fileList[i].name,\n          size: fileList[i].size,\n          file: fileList[i]\n        }; //将图片文件转成Base64\n\n        var reader = new FileReader();\n\n        reader.onloadend = function (e) {\n          _this.getBase64(e.target.result).then(function (url) {\n            _this.$set(fileItem, \"src\", url);\n          });\n        };\n\n        if (fileItem.size > _this.maxSize) {\n          Toast(_this.lang.dynamic_over_size);\n        } else {\n          reader.readAsDataURL(fileList[i]);\n          tempList.push(fileItem);\n\n          _this.files.push(fileItem);\n        }\n      };\n\n      for (var i = 0, len = fileList.length; i < len; i++) {\n        _loop(i, len);\n      }\n\n      this.files.splice(5);\n      tempList.splice(5);\n      setTimeout(function () {\n        _this.$emit(\"getFiles\", tempList);\n      }, 300);\n    },\n    clearFiles: function clearFiles() {\n      this.files = [];\n    },\n    // 图片压缩并保存到files\n    getBase64: function getBase64(url) {\n      var self = this;\n      var Img = new Image(),\n          dataURL = \"\";\n      Img.src = url;\n      var p = new Promise(function (resolve, reject) {\n        Img.onload = function () {\n          //要先确保图片完整获取到，这是个异步事件\n          var canvas = document.createElement(\"canvas\"),\n              //创建canvas元素\n          width = Img.width,\n              //确保canvas的尺寸和图片一样\n          height = Img.height; // 默认将长宽设置为图片的原始长宽，这样在长宽不超过最大长度时就不需要再处理\n\n          var ratio = width / height,\n              maxLength = 1000,\n              newHeight = height,\n              newWidth = width; // 在长宽超过最大长度时，按图片长宽比例等比缩小\n\n          if (width > maxLength || height > maxLength) {\n            if (width > height) {\n              newWidth = maxLength;\n              newHeight = maxLength / ratio;\n            } else {\n              newWidth = maxLength * ratio;\n              newHeight = maxLength;\n            }\n          }\n\n          canvas.width = newWidth;\n          canvas.height = newHeight;\n          canvas.getContext(\"2d\").drawImage(Img, 0, 0, newWidth, newHeight); //将图片绘制到canvas中\n\n          dataURL = canvas.toDataURL(\"image/jpeg\", 0.5); //转换图片为dataURL\n\n          resolve(dataURL);\n        };\n      });\n      return p;\n    },\n    // 移除图片\n    remove: function remove(index, e) {\n      var _this2 = this;\n\n      e.stopPropagation(); //阻止\n\n      this.files.splice(index, 1);\n      setTimeout(function () {\n        _this2.$emit(\"removeFiles\", index);\n      }, 300);\n    },\n    //引入photoSwipe(可预览、滑动)\n    initPhotoSwipeFromDOM: function initPhotoSwipeFromDOM(gallerySelector) {\n      var parseThumbnailElements = function parseThumbnailElements(el) {\n        var thumbElements = el.childNodes,\n            numNodes = thumbElements.length,\n            items = [],\n            figureEl,\n            linkEl,\n            size,\n            item;\n\n        for (var i = 0; i < numNodes - 1; i++) {\n          figureEl = thumbElements[i];\n\n          if (figureEl.nodeType !== 1) {\n            continue;\n          }\n\n          linkEl = figureEl.children[0];\n          var img = new Image();\n          img.src = linkEl.getAttribute(\"href\");\n          linkEl.setAttribute(\"data-size\", img.naturalWidth + \"x\" + img.naturalHeight);\n          size = linkEl.getAttribute(\"data-size\").split(\"x\");\n          item = {\n            src: linkEl.getAttribute(\"href\"),\n            w: parseInt(size[0], 10),\n            h: parseInt(size[1], 10)\n          };\n\n          if (figureEl.children.length > 1) {\n            item.title = figureEl.children[1].innerHTML;\n          }\n\n          if (linkEl.children.length > 0) {\n            item.msrc = linkEl.children[0].getAttribute(\"src\");\n          }\n\n          item.el = figureEl;\n          items.push(item);\n        }\n\n        return items;\n      };\n\n      var closest = function closest(el, fn) {\n        return el && (fn(el) ? el : closest(el.parentNode, fn));\n      };\n\n      var onThumbnailsClick = function onThumbnailsClick(e) {\n        e = e || window.event; // e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n\n        var eTarget = e.target || e.srcElement;\n        var clickedListItem = closest(eTarget, function (el, e) {\n          return el.tagName && el.tagName.toUpperCase() === \"FIGURE\";\n        });\n\n        if (!clickedListItem) {\n          return;\n        }\n\n        var clickedGallery = clickedListItem.parentNode,\n            childNodes = clickedListItem.parentNode.childNodes,\n            numChildNodes = childNodes.length,\n            nodeIndex = 0,\n            index;\n\n        for (var i = 0; i < numChildNodes; i++) {\n          if (childNodes[i].nodeType !== 1) {\n            continue;\n          }\n\n          if (childNodes[i] === clickedListItem) {\n            index = nodeIndex;\n            break;\n          }\n\n          nodeIndex++;\n        }\n\n        if (index >= 0) {\n          openPhotoSwipe(index, clickedGallery);\n        }\n\n        return false;\n      };\n\n      var photoswipeParseHash = function photoswipeParseHash() {\n        var hash = window.location.hash.substring(1),\n            params = {};\n\n        if (hash.length < 5) {\n          return params;\n        }\n\n        var vars = hash.split(\"&\");\n\n        for (var i = 0; i < vars.length; i++) {\n          if (!vars[i]) {\n            continue;\n          }\n\n          var pair = vars[i].split(\"=\");\n\n          if (pair.length < 2) {\n            continue;\n          }\n\n          params[pair[0]] = pair[1];\n        }\n\n        if (params.gid) {\n          params.gid = parseInt(params.gid, 10);\n        }\n\n        return params;\n      };\n\n      var openPhotoSwipe = function openPhotoSwipe(index, galleryElement, disableAnimation, fromURL) {\n        var pswpElement = document.querySelectorAll(\".pswp\")[0],\n            gallery,\n            options,\n            items;\n        items = parseThumbnailElements(galleryElement);\n        options = {\n          history: false,\n          tapToClose: true,\n          galleryUID: galleryElement.getAttribute(\"data-pswp-uid\"),\n          getThumbBoundsFn: function getThumbBoundsFn(index) {\n            var thumbnail = items[index].el.getElementsByTagName(\"img\")[0],\n                pageYScroll = window.pageYOffset || document.documentElement.scrollTop,\n                rect = thumbnail.getBoundingClientRect();\n            return {\n              x: rect.left,\n              y: rect.top + pageYScroll,\n              w: rect.width\n            };\n          }\n        };\n\n        if (fromURL) {\n          if (options.galleryPIDs) {\n            for (var j = 0; j < items.length; j++) {\n              if (items[j].pid == index) {\n                options.index = j;\n                break;\n              }\n            }\n          } else {\n            options.index = parseInt(index, 10) - 1;\n          }\n        } else {\n          options.index = parseInt(index, 10);\n        }\n\n        if (isNaN(options.index)) {\n          return \"\";\n        }\n\n        if (disableAnimation) {\n          options.showAnimationDuration = 0;\n        }\n\n        gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);\n        gallery.init();\n      };\n\n      var galleryElements = document.querySelectorAll(gallerySelector);\n\n      for (var i = 0, l = galleryElements.length; i < l; i++) {\n        galleryElements[i].setAttribute(\"data-pswp-uid\", i + 1);\n        galleryElements[i].onclick = onThumbnailsClick;\n      }\n\n      var hashData = photoswipeParseHash();\n\n      if (hashData.pid && hashData.gid) {\n        openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);\n      }\n    }\n  },\n  mounted: function mounted() {\n    this.initPhotoSwipeFromDOM(\".my-gallery\");\n  }\n};",{"version":3,"sources":["Upload.vue"],"names":[],"mappings":"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","sourcesContent":["\n<!--\nDescription 图片上传及预览组件\n@authors Benny\n@date    2018-05-08 12:57:08\n@version 1.0.0\n-->\n<template>\n    <div id=\"imgUploader\">\n        <div class=\"file-list\">\n            <div class=\"thumbnails my-gallery\">\n                <figure\n                    itemprop=\"associatedMedia\"\n                    itemscope\n                    class=\"thumbnail\"\n                    v-for=\"(item,index) in files\"\n                    :key=\"index\"\n                >\n                    <a\n                        :href=\"item.src\"\n                        itemprop=\"contentUrl\"\n                        data-size=\"400x400\"\n                        class=\"img-wrapper\"\n                    >\n                        <img :src=\"item.src\" itemprop=\"thumbnail\">\n                    </a>\n                    <span class=\"file-remove\" @click=\"remove(index,$event)\">×</span>\n                </figure>\n                <section class=\"thumbnail\" v-if=\"this.files.length < 5\">\n                    <div class=\"add\">\n                        <span>+</span>\n                        <input\n                            type=\"file\"\n                            @change=\"selectImgs()\"\n                            multiple\n                            accept=\"image/*\"\n                            ref=\"file\"\n                        >\n                    </div>\n                </section>\n            </div>\n\n            <!-- PhotoSwipe插件需要的元素， 一定要有类名 pswp -->\n            <div class=\"pswp\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">\n                <div class=\"pswp__bg\"></div>\n                <div class=\"pswp__scroll-wrap\">\n                    <div class=\"pswp__container\">\n                        <div class=\"pswp__item\"></div>\n                        <div class=\"pswp__item\"></div>\n                        <div class=\"pswp__item\"></div>\n                    </div>\n                    <!-- 预览区域顶部的默认UI，可以修改 -->\n                    <div class=\"pswp__ui pswp__ui--hidden\">\n                        <div class=\"pswp__top-bar\">\n                            <!--  与图片相关的操作 -->\n                            <div class=\"pswp__counter\"></div>\n                            <button class=\"pswp__button pswp__button--close\" title=\"Close (Esc)\"></button>\n                            <!--将分享按钮去掉 -->\n                            <div class=\"pswp__preloader\">\n                                <div class=\"pswp__preloader__icn\">\n                                    <div class=\"pswp__preloader__cut\">\n                                        <div class=\"pswp__preloader__donut\"></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"pswp__share-modal pswp__share-modal--hidden pswp__single-tap\">\n                            <div class=\"pswp__share-tooltip\"></div>\n                        </div>\n                        <button\n                            class=\"pswp__button pswp__button--arrow--left\"\n                            title=\"Previous (arrow left)\"\n                        ></button>\n                        <button\n                            class=\"pswp__button pswp__button--arrow--right\"\n                            title=\"Next (arrow right)\"\n                        ></button>\n                        <div class=\"pswp__caption\">\n                            <div class=\"pswp__caption__center\"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nimport PhotoSwipe from \"photoswipe\";\nimport PhotoSwipeUI_Default from \"photoswipe/dist/photoswipe-ui-default\";\nimport \"photoswipe/dist/photoswipe.css\";\nimport \"photoswipe/dist/default-skin/default-skin.css\";\nexport default {\n    data() {\n        return {\n            // lang: this.$lang(\"dynamic\"),\n            files: [], // 文件缓存\n            index: 0, // 序列号\n            maxLength: 5, // 图片最大数量\n            maxSize: 10240000 //图片限制为10M内\n        };\n    },\n    methods: {\n        //选择图片\n        selectImgs() {\n            let fileList = this.$refs.file.files;\n            if (fileList.length > this.maxLength) {\n                this.$toast(\"最大选择图片不能超过5张\");\n            }\n            let tempList = []; //每次点击+号后选择的图片信息\n            for (let i = 0, len = fileList.length; i < len; i++) {\n                let fileItem = {\n                    Id: this.index++,\n                    name: fileList[i].name,\n                    size: fileList[i].size,\n                    file: fileList[i]\n                };\n                //将图片文件转成Base64\n                let reader = new FileReader();\n                reader.onloadend = e => {\n                    this.getBase64(e.target.result).then(url => {\n                        this.$set(fileItem, \"src\", url);\n                    });\n                };\n                if (fileItem.size > this.maxSize) {\n                    Toast(this.lang.dynamic_over_size);\n                } else {\n                    reader.readAsDataURL(fileList[i]);\n                    tempList.push(fileItem)\n                    this.files.push(fileItem);\n                }\n            }\n\n            this.files.splice(5);\n            tempList.splice(5)\n            setTimeout(() => {\n                this.$emit(\"getFiles\", tempList);\n            }, 300);\n        },\n\n        clearFiles() {\n            this.files = []\n        },\n        \n        // 图片压缩并保存到files\n        getBase64(url) {\n            let self = this;\n            let Img = new Image(),\n                dataURL = \"\";\n            Img.src = url;\n            let p = new Promise(function(resolve, reject) {\n                Img.onload = function() {\n                    //要先确保图片完整获取到，这是个异步事件\n                    let canvas = document.createElement(\"canvas\"), //创建canvas元素\n                        width = Img.width, //确保canvas的尺寸和图片一样\n                        height = Img.height;\n                    // 默认将长宽设置为图片的原始长宽，这样在长宽不超过最大长度时就不需要再处理\n                    let ratio = width / height,\n                        maxLength = 1000,\n                        newHeight = height,\n                        newWidth = width;\n                    // 在长宽超过最大长度时，按图片长宽比例等比缩小\n                    if (width > maxLength || height > maxLength) {\n                        if (width > height) {\n                            newWidth = maxLength;\n                            newHeight = maxLength / ratio;\n                        } else {\n                            newWidth = maxLength * ratio;\n                            newHeight = maxLength;\n                        }\n                    }\n                    canvas.width = newWidth;\n                    canvas.height = newHeight;\n                    canvas\n                        .getContext(\"2d\")\n                        .drawImage(Img, 0, 0, newWidth, newHeight); //将图片绘制到canvas中\n                    dataURL = canvas.toDataURL(\"image/jpeg\", 0.5); //转换图片为dataURL\n                    resolve(dataURL);\n                };\n            });\n            return p;\n        },\n        // 移除图片\n        remove(index, e) {\n            e.stopPropagation(); //阻止\n            this.files.splice(index, 1);\n            setTimeout(() => {\n                this.$emit(\"removeFiles\", index);\n            }, 300);\n        },\n        //引入photoSwipe(可预览、滑动)\n        initPhotoSwipeFromDOM(gallerySelector) {\n            var parseThumbnailElements = function(el) {\n                var thumbElements = el.childNodes,\n                    numNodes = thumbElements.length,\n                    items = [],\n                    figureEl,\n                    linkEl,\n                    size,\n                    item;\n                for (var i = 0; i < numNodes - 1; i++) {\n                    figureEl = thumbElements[i];\n                    if (figureEl.nodeType !== 1) {\n                        continue;\n                    }\n                    linkEl = figureEl.children[0];\n                    var img = new Image();\n                    img.src = linkEl.getAttribute(\"href\");\n                    linkEl.setAttribute(\n                        \"data-size\",\n                        img.naturalWidth + \"x\" + img.naturalHeight\n                    );\n                    size = linkEl.getAttribute(\"data-size\").split(\"x\");\n                    item = {\n                        src: linkEl.getAttribute(\"href\"),\n                        w: parseInt(size[0], 10),\n                        h: parseInt(size[1], 10)\n                    };\n                    if (figureEl.children.length > 1) {\n                        item.title = figureEl.children[1].innerHTML;\n                    }\n                    if (linkEl.children.length > 0) {\n                        item.msrc = linkEl.children[0].getAttribute(\"src\");\n                    }\n                    item.el = figureEl;\n                    items.push(item);\n                }\n                return items;\n            };\n            var closest = function closest(el, fn) {\n                return el && (fn(el) ? el : closest(el.parentNode, fn));\n            };\n            var onThumbnailsClick = function(e) {\n                e = e || window.event;\n                // e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n                var eTarget = e.target || e.srcElement;\n                var clickedListItem = closest(eTarget, function(el, e) {\n                    return el.tagName && el.tagName.toUpperCase() === \"FIGURE\";\n                });\n\n                if (!clickedListItem) {\n                    return;\n                }\n                var clickedGallery = clickedListItem.parentNode,\n                    childNodes = clickedListItem.parentNode.childNodes,\n                    numChildNodes = childNodes.length,\n                    nodeIndex = 0,\n                    index;\n                for (var i = 0; i < numChildNodes; i++) {\n                    if (childNodes[i].nodeType !== 1) {\n                        continue;\n                    }\n                    if (childNodes[i] === clickedListItem) {\n                        index = nodeIndex;\n                        break;\n                    }\n                    nodeIndex++;\n                }\n\n                if (index >= 0) {\n                    openPhotoSwipe(index, clickedGallery);\n                }\n                return false;\n            };\n            var photoswipeParseHash = function() {\n                var hash = window.location.hash.substring(1),\n                    params = {};\n                if (hash.length < 5) {\n                    return params;\n                }\n                var vars = hash.split(\"&\");\n                for (var i = 0; i < vars.length; i++) {\n                    if (!vars[i]) {\n                        continue;\n                    }\n                    var pair = vars[i].split(\"=\");\n                    if (pair.length < 2) {\n                        continue;\n                    }\n                    params[pair[0]] = pair[1];\n                }\n                if (params.gid) {\n                    params.gid = parseInt(params.gid, 10);\n                }\n                return params;\n            };\n\n            var openPhotoSwipe = function(\n                index,\n                galleryElement,\n                disableAnimation,\n                fromURL\n            ) {\n                var pswpElement = document.querySelectorAll(\".pswp\")[0],\n                    gallery,\n                    options,\n                    items;\n                items = parseThumbnailElements(galleryElement);\n                options = {\n                    history: false,\n                    tapToClose: true,\n                    galleryUID: galleryElement.getAttribute(\"data-pswp-uid\"),\n                    getThumbBoundsFn: function(index) {\n                        var thumbnail = items[index].el.getElementsByTagName(\n                                \"img\"\n                            )[0],\n                            pageYScroll =\n                                window.pageYOffset ||\n                                document.documentElement.scrollTop,\n                            rect = thumbnail.getBoundingClientRect();\n                        return {\n                            x: rect.left,\n                            y: rect.top + pageYScroll,\n                            w: rect.width\n                        };\n                    }\n                };\n                if (fromURL) {\n                    if (options.galleryPIDs) {\n                        for (var j = 0; j < items.length; j++) {\n                            if (items[j].pid == index) {\n                                options.index = j;\n                                break;\n                            }\n                        }\n                    } else {\n                        options.index = parseInt(index, 10) - 1;\n                    }\n                } else {\n                    options.index = parseInt(index, 10);\n                }\n                if (isNaN(options.index)) {\n                    return \"\";\n                }\n                if (disableAnimation) {\n                    options.showAnimationDuration = 0;\n                }\n\n                gallery = new PhotoSwipe(\n                    pswpElement,\n                    PhotoSwipeUI_Default,\n                    items,\n                    options\n                );\n                gallery.init();\n            };\n            var galleryElements = document.querySelectorAll(gallerySelector);\n            for (var i = 0, l = galleryElements.length; i < l; i++) {\n                galleryElements[i].setAttribute(\"data-pswp-uid\", i + 1);\n                galleryElements[i].onclick = onThumbnailsClick;\n            }\n            var hashData = photoswipeParseHash();\n            if (hashData.pid && hashData.gid) {\n                openPhotoSwipe(\n                    hashData.pid,\n                    galleryElements[hashData.gid - 1],\n                    true,\n                    true\n                );\n            }\n        }\n    },\n    mounted() {\n        this.initPhotoSwipeFromDOM(\".my-gallery\");\n    }\n};\n</script>\n\n<style lang=\"less\" scoped>\n#imgUploader {\n    flex: 1;\n    margin-top: auto;\n    background: #f7f7f7;\n    padding: 10px 0;\n    .file-list {\n        .file-remove {\n            position: absolute;\n            font-size: 12px;\n            right: -5px;\n            top: -5px;\n            width: 14px;\n            height: 14px;\n            color: white;\n            cursor: pointer;\n            line-height: 14px;\n            background: rgba(0, 0, 0, 05);\n            border-radius: 3px;\n            z-index: 1000;\n            text-align: center;\n        }\n\n        &:hover .file-remove {\n            display: inline;\n        }\n    }\n}\n.add {\n    width: 100%;\n    height: 50px;\n    float: left;\n    text-align: center;\n    line-height: 50px;\n    // font-size: 1.4rem;\n    font-weight: 100;\n    cursor: pointer;\n    border: 1px dashed #ccc;\n    color: #999;\n    position: relative;\n    // background: #f2f2f2;\n    @media screen and(min-width:768px) and(max-width:1024px) {\n        height: 180px;\n        line-height: 180px;\n        font-size: 56px;\n    }\n    .fa {\n        font-size: 1.4em;\n        color: #7dd2d9;\n    }\n}\n.uploadBtn {\n    position: relative;\n    .empty {\n        position: absolute;\n        right: 0;\n        bottom: 0;\n        background-color: #eee;\n        color: #fff;\n        padding: 0.2em 1em;\n    }\n}\n\n.thumbnails {\n    margin: 0;\n    width: 90%;\n    margin: 0 auto;\n    background: #f7f7f7;\n    display: -webkit-box;\n    display: -webkit-flex;\n    display: -ms-flexbox;\n    display: flex;\n    .thumbnail {\n        position: relative;\n        width: 50px;\n        box-sizing: border-box;\n        height: 50px;\n        margin-right: 10px;\n        .img-wrapper {\n            position: relative;\n            display: flex;\n            height: 50px;\n            img {\n                width: auto;\n                height: auto;\n                width: 100%;\n                max-width: 100%;\n                max-height: 100%;\n                object-fit: cover;\n            }\n        }\n    }\n}\ninput[type=\"file\"] {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 50px;\n    opacity: 0;\n}\n</style>\n"],"sourceRoot":"src/components/rate"}]}
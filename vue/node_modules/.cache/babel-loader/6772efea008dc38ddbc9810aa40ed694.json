{"remainingRequest":"/Users/mia/Documents/wxypwebapp/vue/node_modules/babel-loader/lib/index.js!/Users/mia/Documents/wxypwebapp/vue/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/mia/Documents/wxypwebapp/vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mia/Documents/wxypwebapp/vue/src/views/Home.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mia/Documents/wxypwebapp/vue/src/views/Home.vue","mtime":1554103443663},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypwebapp/vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.search\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/mia/Documents/wxypwebapp/vue/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport HomeRecommend from '@/components/home/HomeRecommend';\nimport HomeFoor from '@/components/home/HomeFoor';\nimport HomeHot from '@/components/home/HomeHot';\nimport HomeSearch from '@/components/home/HomeSearch';\nimport HomeSwiper from '@/components/home/HomeSwiper';\nimport HomePanl from '@/components/home/HomePanl';\nimport Scroll from 'public/Scroll';\nimport BaseFooter from 'public/BaseFooter';\nimport BaseRefresh from '@/components/home/BaseRefresh';\nimport { vuexData, page } from 'js/mixin';\nimport { throttle } from 'js/util';\nexport default {\n  name: \"Home\",\n  mixins: [page, vuexData],\n  data: function data() {\n    return {\n      value: '',\n      recommend: '',\n      num: 1,\n      bounce: {\n        top: false\n      },\n      probeType: 3,\n      floorName: '',\n      touch: {},\n      transformY: 0,\n      rotate: 0,\n      isRotate: false,\n      trans: false,\n      opac: 0,\n      currentCity: '',\n      query: false,\n      // 显示搜索\n      len: false,\n      // 是否含有搜索结果\n      page: 1,\n      searchLoading: false\n    };\n  },\n  components: {\n    HomeRecommend: HomeRecommend,\n    HomeFoor: HomeFoor,\n    HomeSearch: HomeSearch,\n    HomeHot: HomeHot,\n    Scroll: Scroll,\n    BaseRefresh: BaseRefresh,\n    HomeSwiper: HomeSwiper,\n    HomePanl: HomePanl,\n    BaseFooter: BaseFooter\n  },\n  methods: {\n    scroll: function scroll(e) {\n      Math.abs(e.y) == 0 ? this.touch.scroll = true : this.touch.scroll = false;\n\n      if (this.transformY > 0) {\n        this.$refs.scroll.disable();\n      }\n    },\n    touchstart: function touchstart(e) {\n      this.isRotate = false;\n      this.trans = false;\n      this.touch.init = true;\n      this.touch.startY = e.touches[0].pageY; //第一次点击的位置\n    },\n    touchmove: function touchmove(e) {\n      if (!this.touch.scroll || !this.touch.init || e.touches[0].pageY > window.innerHeight) return;\n      var pageY = e.touches[0].pageY;\n      var daltaY = pageY - this.touch.startY; //滑动的位置\n\n      this.transformY = Math.max(0, daltaY / 3.5);\n      this.rotate = Math.max(0, Math.min(360, daltaY));\n      if (this.transformY > 80) this.touch.isRotate = true;\n      this.opac = daltaY / 320;\n    },\n    touchend: function () {\n      var _touchend = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(e) {\n        var _this = this;\n\n        var _ref, data, datas;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.$refs.scroll.enable();\n                if (this.transformY > 0) this.trans = true;\n                this.isRotate = true;\n\n                if (this.touch.isRotate) {\n                  _context.next = 9;\n                  break;\n                }\n\n                this.transformY = 0;\n                this.isRotate = false;\n                setTimeout(function () {\n                  _this.opac = 0;\n                }, 300);\n                _context.next = 27;\n                break;\n\n              case 9:\n                this.touch.isRotate = false;\n\n                if (!(this.transformY > 100)) {\n                  _context.next = 24;\n                  break;\n                }\n\n                _context.prev = 11;\n                _context.next = 14;\n                return this.Api.recommend();\n\n              case 14:\n                _ref = _context.sent;\n                data = _ref.data;\n\n                if (data.code == 200) {\n                  datas = data.data;\n                  this.recommend = datas;\n                  this.floorName = datas.floorName;\n                  setTimeout(function () {\n                    _this.transformY = 0;\n                    _this.rotate = 0;\n                  }, 1000);\n                  setTimeout(function () {\n                    _this.isRotate = false;\n                    _this.opac = 0;\n\n                    _this.$toast('刷新成功');\n                  }, 1500);\n                }\n\n                _context.next = 22;\n                break;\n\n              case 19:\n                _context.prev = 19;\n                _context.t0 = _context[\"catch\"](11);\n                this.$toast('刷新失败,网络错误');\n\n              case 22:\n                _context.next = 27;\n                break;\n\n              case 24:\n                this.transformY = 0;\n                this.rotate = 0;\n                this.isRotate = false;\n\n              case 27:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[11, 19]]);\n      }));\n\n      function touchend(_x) {\n        return _touchend.apply(this, arguments);\n      }\n\n      return touchend;\n    }(),\n    details: function details(val) {\n      var id = {\n        goodsId: val.goodsId\n      };\n      this.setGoodDetails(id);\n      this.$router.push({\n        name: \"Details\",\n        query: {\n          id: val.goodsId\n        }\n      });\n    },\n    searchDetails: function searchDetails(id) {\n      this.$refs.input.blur();\n      this.$router.push({\n        name: \"Details\",\n        query: {\n          id: id\n        }\n      });\n    },\n    cityClick: function cityClick() {\n      this.$router.push({\n        name: 'City'\n      });\n    },\n    getHome: function () {\n      var _getHome = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var _ref2, data;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                this.showFlag = true;\n                _context2.next = 4;\n                return this.Api.recommend();\n\n              case 4:\n                _ref2 = _context2.sent;\n                data = _ref2.data;\n\n                if (data.code == 200) {\n                  this.showFlag = false;\n                  this.recommend = data.data;\n                  this.floorName = data.data.floorName;\n                  this.setTab(data.data.category);\n                }\n\n                _context2.next = 13;\n                break;\n\n              case 9:\n                _context2.prev = 9;\n                _context2.t0 = _context2[\"catch\"](0);\n                this.showFlag = false;\n                this.$toast('网络错误');\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[0, 9]]);\n      }));\n\n      function getHome() {\n        return _getHome.apply(this, arguments);\n      }\n\n      return getHome;\n    }(),\n    // 跳转到商品分类\n    item: function item(val, index) {\n      var id = val.bxMallSubDto[0].mallSubId;\n      this.$router.push({\n        name: \"Category\",\n        params: {\n          id: id,\n          index: index,\n          val: val\n        }\n      });\n    },\n    //搜索\n    search: function () {\n      var _search = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3(value, flag) {\n        var _ref3, data;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n\n                if (!this.isLocked()) {\n                  _context3.next = 3;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 3:\n                // 必须等待上一次请求完成\n                this.locked(); //开始请求之前锁住\n\n                this.searchLoading = true;\n                this.len = false;\n                _context3.next = 8;\n                return this.Api.search(value, this.page);\n\n              case 8:\n                _ref3 = _context3.sent;\n                data = _ref3.data;\n\n                if (data.code == 200) {\n                  this.setTotal(data.data.count); // 总条数\n\n                  this.unLocked(); // 解锁\n\n                  this.searchLoading = false;\n\n                  if (flag) {\n                    this.setNewData(data.data.list);\n                  } else {\n                    this.dataArr = data.data.list;\n                  }\n\n                  if (!this.dataArr.length) {\n                    this.len = true;\n                  }\n                }\n\n                _context3.next = 18;\n                break;\n\n              case 13:\n                _context3.prev = 13;\n                _context3.t0 = _context3[\"catch\"](0);\n                this.unLocked(); // 解锁\n\n                this.len = false;\n                this.$toast('网络错误');\n\n              case 18:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[0, 13]]);\n      }));\n\n      function search(_x2, _x3) {\n        return _search.apply(this, arguments);\n      }\n\n      return search;\n    }(),\n    // 取消搜索\n    onCancel: function onCancel() {\n      this.value = '';\n    },\n    focus: function focus() {\n      var width = '85%';\n      this.tran(width);\n      this.query = true;\n    },\n    closeSearch: function closeSearch() {\n      var _this2 = this;\n\n      var width = '100%';\n      this.tran(width);\n      this.query = false;\n      setTimeout(function () {\n        _this2.value = '';\n      }, 300);\n    },\n    tran: function tran(width) {\n      this.$refs.searchBox.style.width = width;\n      this.$refs.searchBox.style['transitionDuration'] = '.3s';\n    },\n    vals: function vals(val) {\n      this.value = val;\n    },\n    scrollToEnd: function scrollToEnd() {\n      if (this.dataArr.length >= 20) {\n        if (this.hasMore()) {\n          this.page++;\n          this.search(this.value, true);\n        } else {\n          this.$toast('没有很多数据了~~');\n        }\n      }\n    },\n    scrollToEnd2: function scrollToEnd2() {\n      this.$refs.scroll.refresh();\n    }\n  },\n  created: function created() {\n    var _this3 = this;\n\n    this.getHome(); // 节流函数处理\n\n    this.$watch('value', throttle(function () {\n      _this3.dataArr = [];\n\n      if (_this3.value) {\n        _this3.page = 1;\n\n        _this3.search(_this3.value, false);\n      }\n    }, 800));\n  },\n  watch: {\n    city: function city() {\n      this.getHome();\n    }\n  }\n};",{"version":3,"sources":["Home.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <div class=\"home page-tab\">\n        <div class=\"header\">\n            <van-row>\n                <div @click=\"cityClick\" >\n                <van-col span=\"5\" class=\"city\">{{city}} ▼</van-col>\n                </div>\n                <van-col span=\"19\" >\n                    <div class=\"search-box\" ref=\"searchBox\">\n                        <van-icon name=\"search\" class=\"icon\"/>\n                        <input ref=\"input\"  @focus=\"focus\"  class=\"box\" v-model=\"value\" type=\"text\" placeholder=\"请输入搜索关键词\">\n                        <van-icon name=\"clear\" @click=\"value=''\"  v-show=\"value\" class=\"clear\"/>\n                    </div>\n                    <transition name=\"bouncee\">\n                        <div class=\"quxiao\" v-show=\"query\" @click=\"closeSearch\">取消</div>\n                    </transition>\n                </van-col>\n            </van-row>\n        </div>\n    <div v-show=\"!showFlag\"  class=\"content\" @touchmove.prevent='touchmove' @touchstart.prevent='touchstart' @touchend.prevent='touchend'>\n        <Scroll v-if=\"recommend\" :pullup='true' @scrollToEnd='scrollToEnd2' :listenScroll='true' @scroll='scroll' :probeType='probeType'  :data='recommend.hotGoods' class=\"content-scroll\" :bounce='bounce' ref=\"scroll\">\n            <div>\n                <HomeSwiper :slides='recommend.slides'/>\n                <HomePanl :category='recommend.category' @item='item' :advertesPicture='recommend.advertesPicture.PICTURE_ADDRESS'/>\n                <HomeRecommend :recommend='recommend.recommend'/>\n                <HomeFoor :floorName='floorName.floor1' :foor1='recommend.floor1' :num='num'/>\n                <HomeFoor :floorName='floorName.floor2' :foor1='recommend.floor2' :num='num+1'/>\n                <HomeFoor :floorName='floorName.floor3' :foor1='recommend.floor3' :num='num+2'/> \n                <HomeHot :hot='recommend.hotGoods'/>\n            </div>\n        </Scroll>\n        <dir v-show=\"touch.init\">\n         <BaseRefresh :opacity='opac' :transformY='transformY' :rotate='rotate' :isRotate='isRotate' :trans='trans'/>\n\n        </dir>\n     </div>\n        <!-- <BaseLoding :showFlag='showFlag'/> -->\n        <HomeSearch v-show=\"query\" @scrollToEnd='scrollToEnd' :list='dataArr' @details='searchDetails' :len='len' :value='value' @vals='vals'/>\n        <div v-show=\"searchLoading\" class=\"van-loading van-loading--circular van-loading--white\" style=\"color: white;z-index:999\"><span class=\"van-loading__spinner van-loading__spinner--circular\"><svg viewBox=\"25 25 50 50\" class=\"van-loading__circular\"><circle cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\"></circle></svg></span></div>\n        <BaseFooter active='0'/>\n        <router-view/>\n</div>\n\n\n</template>\n\n<script>\nimport HomeRecommend from '@/components/home/HomeRecommend'\nimport HomeFoor from '@/components/home/HomeFoor'\nimport HomeHot from '@/components/home/HomeHot'\nimport HomeSearch from '@/components/home/HomeSearch'\nimport HomeSwiper from '@/components/home/HomeSwiper'\nimport HomePanl from '@/components/home/HomePanl'\nimport Scroll from 'public/Scroll'\nimport BaseFooter from 'public/BaseFooter'\nimport BaseRefresh from '@/components/home/BaseRefresh'\nimport {vuexData,page} from 'js/mixin'\nimport {throttle} from 'js/util'\nexport default {\n    name: \"Home\",\n    mixins: [page,vuexData],\n    data() {\n        return {\n            value: '',\n            recommend: '',\n            num: 1,\n            bounce: {\n                top:false,\n            },\n            probeType: 3,\n            floorName: '',\n            touch: {},\n            transformY: 0,\n            rotate: 0,\n            isRotate: false,\n            trans: false,\n            opac: 0,\n            currentCity: '',\n            query: false,       // 显示搜索\n            len: false,        // 是否含有搜索结果\n            page: 1,\n            searchLoading: false,\n        }\n    },\n    \n    components: {\n        HomeRecommend,\n        HomeFoor,\n        HomeSearch,\n        HomeHot,\n        Scroll,\n        BaseRefresh,\n        HomeSwiper,\n        HomePanl,\n        BaseFooter,\n    },\n    methods: {\n        scroll(e) {\n            Math.abs(e.y) == 0 ? this.touch.scroll = true : this.touch.scroll = false\n            if (this.transformY > 0) {\n                this.$refs.scroll.disable()\n            }\n        },\n        \n        touchstart(e) {\n            this.isRotate = false\n            this.trans = false\n            this.touch.init = true\n            this.touch.startY = e.touches[0].pageY        //第一次点击的位置\n        },\n        touchmove(e) {\n            if (!this.touch.scroll || !this.touch.init || e.touches[0].pageY > window.innerHeight) return\n            let pageY = e.touches[0].pageY\n            let daltaY = pageY -  this.touch.startY   //滑动的位置\n            this.transformY = Math.max(0, daltaY / 3.5)\n            this.rotate = Math.max(0,Math.min(360,daltaY) ) \n            if (this.transformY > 80 ) this.touch.isRotate = true\n            this.opac = daltaY / 320\n        },\n        async touchend(e) {\n            this.$refs.scroll.enable()\n            if (this.transformY > 0) this.trans = true\n            this.isRotate = true\n            if (!this.touch.isRotate ) {\n                 this.transformY = 0\n                 this.isRotate = false\n                 setTimeout(() => {\n                     this.opac = 0\n                 }, 300);\n            } else {\n                this.touch.isRotate = false\n                if (this.transformY > 100) {\n                    // 请求接口刷新数据\n                    try {\n                        const {data} = await this.Api.recommend()\n                        if (data.code == 200) {\n                            const datas = data.data\n                            this.recommend = datas\n                            this.floorName = datas.floorName\n                            setTimeout(() => {\n                                this.transformY = 0\n                                this.rotate = 0\n                                \n                            }, 1000);\n                            setTimeout(() => {\n                                this.isRotate = false\n                                this.opac = 0\n                                this.$toast('刷新成功')\n                            }, 1500);\n                        }\n                    } catch (error) {\n                        this.$toast('刷新失败,网络错误')\n                    }\n                    \n                }  else {\n                    this.transformY = 0\n                    this.rotate = 0\n                    this.isRotate = false\n                }\n            }\n        },\n        details(val) {\n            let id = {\n                goodsId: val.goodsId\n            }\n            this.setGoodDetails(id)\n            this.$router.push({name:`Details`,query: {id:val.goodsId}})\n        },\n        \n        searchDetails(id) {\n            this.$refs.input.blur()\n            this.$router.push({name:`Details`,query: {id}})\n        },\n        cityClick() {\n            this.$router.push({name: 'City'})\n        },\n        async getHome() {\n            try {\n                this.showFlag = true\n                const {data} = await this.Api.recommend()\n                if (data.code == 200) {\n                    this.showFlag = false\n                    this.recommend = data.data\n                    this.floorName = data.data.floorName\n                    this.setTab(data.data.category)\n                }\n            } catch (error) {\n                this.showFlag = false\n                this.$toast('网络错误')\n            }\n        },\n        // 跳转到商品分类\n        item(val,index) {\n            const id = val.bxMallSubDto[0].mallSubId\n            this.$router.push({\n                name: `Category`,\n                params: {\n                    id,\n                    index,\n                    val\n                }\n            })\n        },\n        //搜索\n        async search(value,flag) {\n            try {\n                if (this.isLocked()) return // 必须等待上一次请求完成\n                this.locked()//开始请求之前锁住\n                this.searchLoading = true\n                this.len = false\n                const {data} = await this.Api.search(value,this.page)\n                if (data.code == 200) {\n                    this.setTotal(data.data.count)  // 总条数\n                    this.unLocked() // 解锁\n                    this.searchLoading = false\n                    if (flag) {\n                        this.setNewData(data.data.list)\n                    } else {\n                        this.dataArr = data.data.list\n                    }\n                    if (!this.dataArr.length) {\n                        this.len = true\n                    }\n                }\n            } catch (error) {\n                this.unLocked() // 解锁\n                this.len = false\n                this.$toast('网络错误')\n            }\n            \n        },\n        // 取消搜索\n        onCancel() {\n            this.value = ''\n            \n        },\n        focus(){\n            let width =  '85%'\n            this.tran(width)\n            this.query = true\n        },\n        closeSearch(){\n            let width =  '100%'\n            this.tran(width)\n            this.query = false\n            setTimeout(() => {\n                this.value = ''\n            }, 300);\n        },\n        tran(width) {\n            this.$refs.searchBox.style.width = width;\n            this.$refs.searchBox.style['transitionDuration'] = '.3s'\n        },\n        vals(val) {\n            this.value = val\n        } ,\n        scrollToEnd() {\n            if (this.dataArr.length >= 20) {\n                if (this.hasMore()) {\n                    this.page++\n                    this.search(this.value,true)\n                } else {\n                    this.$toast('没有很多数据了~~')\n                }\n            }\n        },\n        scrollToEnd2() {\n            this.$refs.scroll.refresh()\n        },\n    },\n    \n    created() {\n        this.getHome()\n        // 节流函数处理\n        this.$watch('value',throttle(() => {\n            this.dataArr = []\n            if (this.value) {\n                this.page = 1\n                this.search(this.value,false)\n            } \n        },800))\n    },\n    watch: {\n        city() {\n            this.getHome()\n        },\n        \n    }\n}\n</script>\n<style lang=\"less\" scoped>\n@color: #F2F2F2;\n\n.header {\n    line-height: 44px;\n    position: relative;\n    z-index: 10;\n    background: #eee;\n    .city {\n        text-align: center;\n        background: @color;\n        font-size: 12px;\n        position: relative;\n        max-width: 120px;\n        .icon {\n            transform: rotate(270deg);\n            position: absolute;\n            top: 35%;\n            right: -12%\n        }\n    }\n}\n.content {\n    position: fixed;\n    top: 44px;\n    left: 0;\n    right: 0;\n    bottom: 50px;\n    .content-scroll {\n        height: 100%;\n        overflow: hidden;\n    }\n    \n}\n     .search-box {\n         display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n        -ms-flex-align: center;\n        align-items: center;\n        -webkit-box-sizing: border-box;\n        box-sizing: border-box;\n        width: 100%;\n        height: 44px;\n        background: #eee;\n        position: relative;\n        .icon {\n            font-size: 16px;\n            color: #222;\n            position: absolute;\n            left: 10px;\n        }\n        .box {\n            -webkit-box-flex: 1;\n            -ms-flex: 1;\n            flex: 1;\n            line-height: 18px;\n            background: #fff;\n            color: #333;\n            font-size: 14px;\n            outline: 0;\n            margin-right: 5px;\n            border-radius: 5px;\n            padding: 7px;\n            padding-left: 32px;\n            -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n        }\n        .clear {\n            position: absolute;\n            right: 12px;\n            color: #999;\n        }\n     }\n    .quxiao {\n        position: absolute;\n        right: 8px;\n        top: 0%;\n        font-size: 16px;\n    }\n \n.bouncee-enter-active {\n        animation: bounce-in .3s;\n    }\n.bouncee-leave-active {\n        animation: bounce-in .1s reverse;\n    }\n@keyframes bounce-in {\n    0% {\n        transform: translate3d(100%,0,0)\n    }\n    \n    100% {\n        transform: translate3d(0,0,0)\n    }\n} \n</style>"],"sourceRoot":"src/views"}]}
{"remainingRequest":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js??vue-loader-options!/Users/mia/Documents/wxypapp/Vue-shopping/vue/src/views/ShoppingPayMent.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/src/views/ShoppingPayMent.vue","mtime":1554103443665},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_babel-loader@8.0.5@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport GoodsList from 'public/GoodsList'\nimport {vuexData} from 'js/mixin'\nimport Scroll from 'public/Scroll'\nexport default {\n    name: \"ShoppingPayMent\",\n    mixins:[vuexData],\n    components: {\n        GoodsList,\n        Scroll,\n    },\n\n    beforeRouteEnter (to, from, next) {\n        next(vm => {\n            vm.getDefaultAddress()\n            if (!vm.shopOrderList.length) {\n                vm.$router.push({name:'ShoppingCart'})\n                \n            }\n        })\n        \n    },\n    computed: {\n        price() {\n            let num = 0\n            if (this.shopOrderList.length) {\n                    this.shopOrderList.forEach( item => {\n                    num += item.present_price * item.count\n                })\n                return Number( num.toFixed(2) * 100)\n            }\n        }\n    },\n\n    data() {\n        return {\n            caitiao: require('img/caitiao.jpg'),\n            isLoading: false,\n            list: [],\n            defaultAdd:''\n        }\n    },\n\n\n    methods: {\n        // 查询默认收货地址\n        async getDefaultAddress() {\n            try {\n                const {data} = await this.Api.getDefaultAddress()\n                if (data.code == 200) {\n                    this.defaultAdd = data.defaultAdd\n                }\n            } catch (error) {\n                this.$toast('网络错误')\n            }\n            \n        },\n\n        goBack() {\n            this.$router.go(-1)\n            setTimeout(() => {\n                this.setShopList([])\n                this.setVuexAddress('')\n            }, 300);\n        },\n\n        async onSubmit() {\n            if (!this.defaultAdd || !this.defaultAdd._id && (!this.temporaryAddress || !this.temporaryAddress._id)) {\n                this.$toast('请添加收获地址')\n                return\n            }\n            this.isLoading = true\n            // 传地址id，订单id，和总价格\n            let Addressid = 123456745;\n            let orderId = []\n            console.log(this.shopOrderList);\n            \n            this.shopOrderList.forEach( item => {\n                orderId.push(item.cid)\n            })\n            \n            try {\n                const { data } = await this.Api.placeOrder({\n                    address:  this.temporaryAddress.address || this.defaultAdd.address,\n                    tel: this.temporaryAddress.tel || this.defaultAdd.tel,\n                    orderId,\n                    totalPrice: (this.price / 100).toFixed(2),\n                    idDirect: this.shopOrderList[0].idDirect,\n                    count: this.shopOrderList[0].count\n                })\n                if (data.code == 200) {\n                    this.isLoading = false\n                    this.$toast(data.msg)\n                    setTimeout(() => {\n                        this.setShopList([])\n                        this.$router.push({path: '/'})\n                        // location.href = '/'\n                    }, 2000);\n                }\n            } catch (err) {\n                this.isLoading = false\n                this.$toast('网络错误')\n            }\n        },\n\n\n        // 添加收货地址\n        goAddress() {\n            this.$router.push({name: 'Address'})\n        },\n\n        // 选择地址\n        editAddress() {\n            this.$router.push({name:'Address'})\n        }\n    }\n}\n",{"version":3,"sources":["ShoppingPayMent.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"ShoppingPayMent.vue","sourceRoot":"src/views","sourcesContent":["<template>\n    <!-- 订单结算和选择商品页面 -->\n    <div class=\"order\">\n        <van-nav-bar\n                title=\"订单结算\"\n                left-arrow\n                @click-left=\"goBack\"\n        />\n                <div class=\"address-warp\">\n                    <div class=\"address addnull\" v-if=\"!defaultAdd || !defaultAdd._id && (!temporaryAddress || !temporaryAddress._id)\" @click=\"goAddress\">\n                        点击添加收获地址\n                    </div>\n                    <div class=\"address\" v-else @click=\"editAddress\">\n                        <div class=\"icon\"><van-icon name=\"location\" class=\"location\"/></div>\n                        <div class=\"address-cont\">\n                            <p class=\"name\">收货人: {{temporaryAddress.name || defaultAdd.name}} <span>{{temporaryAddress.tel || defaultAdd.tel}}</span></p>\n                            <p class=\"address-e\">收货地址: {{temporaryAddress.address || defaultAdd.address}}</p>\n                            <p class=\"no\">(收货不便时,可选择免费待收货服务)</p>\n                        </div>\n                        <div class=\"icon2\"><van-icon name=\"arrow\" class=\"location\"/></div>\n                    </div>\n                    <img :src=\"caitiao\" width=\"100%\" height=\"3px\" alt=\"\" class=\"caitiao\">\n                <Scroll :data='shopOrderList' ref=\"scroll\" class=\"scroll\">\n                    <div class=\"goods-list\">\n                        <GoodsList :list='shopOrderList' :isOrder='true'/>\n                    </div>\n                </Scroll>\n            </div>\n        \n        <div v-if=\"shopOrderList && shopOrderList.length\">\n            <van-submit-bar\n                :loading='isLoading'\n                :price=\"price\"\n                button-text=\"提交订单\"\n                @submit=\"onSubmit\"\n            />\n        </div>\n    </div>\n</template>\n\n<script>\nimport GoodsList from 'public/GoodsList'\nimport {vuexData} from 'js/mixin'\nimport Scroll from 'public/Scroll'\nexport default {\n    name: \"ShoppingPayMent\",\n    mixins:[vuexData],\n    components: {\n        GoodsList,\n        Scroll,\n    },\n\n    beforeRouteEnter (to, from, next) {\n        next(vm => {\n            vm.getDefaultAddress()\n            if (!vm.shopOrderList.length) {\n                vm.$router.push({name:'ShoppingCart'})\n                \n            }\n        })\n        \n    },\n    computed: {\n        price() {\n            let num = 0\n            if (this.shopOrderList.length) {\n                    this.shopOrderList.forEach( item => {\n                    num += item.present_price * item.count\n                })\n                return Number( num.toFixed(2) * 100)\n            }\n        }\n    },\n\n    data() {\n        return {\n            caitiao: require('img/caitiao.jpg'),\n            isLoading: false,\n            list: [],\n            defaultAdd:''\n        }\n    },\n\n\n    methods: {\n        // 查询默认收货地址\n        async getDefaultAddress() {\n            try {\n                const {data} = await this.Api.getDefaultAddress()\n                if (data.code == 200) {\n                    this.defaultAdd = data.defaultAdd\n                }\n            } catch (error) {\n                this.$toast('网络错误')\n            }\n            \n        },\n\n        goBack() {\n            this.$router.go(-1)\n            setTimeout(() => {\n                this.setShopList([])\n                this.setVuexAddress('')\n            }, 300);\n        },\n\n        async onSubmit() {\n            if (!this.defaultAdd || !this.defaultAdd._id && (!this.temporaryAddress || !this.temporaryAddress._id)) {\n                this.$toast('请添加收获地址')\n                return\n            }\n            this.isLoading = true\n            // 传地址id，订单id，和总价格\n            let Addressid = 123456745;\n            let orderId = []\n            console.log(this.shopOrderList);\n            \n            this.shopOrderList.forEach( item => {\n                orderId.push(item.cid)\n            })\n            \n            try {\n                const { data } = await this.Api.placeOrder({\n                    address:  this.temporaryAddress.address || this.defaultAdd.address,\n                    tel: this.temporaryAddress.tel || this.defaultAdd.tel,\n                    orderId,\n                    totalPrice: (this.price / 100).toFixed(2),\n                    idDirect: this.shopOrderList[0].idDirect,\n                    count: this.shopOrderList[0].count\n                })\n                if (data.code == 200) {\n                    this.isLoading = false\n                    this.$toast(data.msg)\n                    setTimeout(() => {\n                        this.setShopList([])\n                        this.$router.push({path: '/'})\n                        // location.href = '/'\n                    }, 2000);\n                }\n            } catch (err) {\n                this.isLoading = false\n                this.$toast('网络错误')\n            }\n        },\n\n\n        // 添加收货地址\n        goAddress() {\n            this.$router.push({name: 'Address'})\n        },\n\n        // 选择地址\n        editAddress() {\n            this.$router.push({name:'Address'})\n        }\n    }\n}\n</script>\n\n<style lang=\"stylus\" scoped>\n.order\n    position fixed\n    top 0px\n    left 0\n    right 0\n    bottom 0px\n    z-index 500\n    background #fff\n    .scroll\n        position fixed\n        top 148px\n        bottom 50px\n        left 0\n        right 0\n        overflow hidden\n    .address-warp\n        .caitiao\n            margin-top -10px\n        .addnull\n            align-items center\n            padding 0!important   \n            justify-content center\n            font-size 14px\n        .address\n            display flex\n            height 90px\n            padding 10px\n            padding-bottom 0\n            background #fff\n            .icon\n                flex 0 0 30px \n                width 30px\n                align-self center\n                margin-right 8px\n                .location\n                    font-size 24px\n            .address-cont\n                flex 1\n                display flex\n                flex-direction column\n                justify-content space-around    \n                .name\n                    font-size 15px\n                    span \n                        float right \n                        margin-right 10px\n                .address-e\n                    font-size 12px\n                    margin-right 5px\n                    line-height 1.4       \n                .no\n                    color #F9CC9D\n                    font-size 12px     \n                    letter-spacing 1px\n                    margin-top -5px\n            .icon2\n                flex 0 0 10px\n                align-self center \n        .goods-list\n            background #fff                   \n</style>\n"]}]}
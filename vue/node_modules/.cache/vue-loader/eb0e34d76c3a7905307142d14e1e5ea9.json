{"remainingRequest":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js??vue-loader-options!/Users/mia/Documents/wxypapp/Vue-shopping/vue/src/views/Home.vue?vue&type=style&index=0&id=fae5bece&lang=less&scoped=true&","dependencies":[{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/src/views/Home.vue","mtime":1554103443663},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_css-loader@1.0.1@css-loader/index.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_vue-loader@15.7.0@vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_less-loader@4.1.0@less-loader/dist/cjs.js","mtime":1554104154590},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mia/Documents/wxypapp/Vue-shopping/vue/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@color: #F2F2F2;\n\n.header {\n    line-height: 44px;\n    position: relative;\n    z-index: 10;\n    background: #eee;\n    .city {\n        text-align: center;\n        background: @color;\n        font-size: 12px;\n        position: relative;\n        max-width: 120px;\n        .icon {\n            transform: rotate(270deg);\n            position: absolute;\n            top: 35%;\n            right: -12%\n        }\n    }\n}\n.content {\n    position: fixed;\n    top: 44px;\n    left: 0;\n    right: 0;\n    bottom: 50px;\n    .content-scroll {\n        height: 100%;\n        overflow: hidden;\n    }\n    \n}\n     .search-box {\n         display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n        -ms-flex-align: center;\n        align-items: center;\n        -webkit-box-sizing: border-box;\n        box-sizing: border-box;\n        width: 100%;\n        height: 44px;\n        background: #eee;\n        position: relative;\n        .icon {\n            font-size: 16px;\n            color: #222;\n            position: absolute;\n            left: 10px;\n        }\n        .box {\n            -webkit-box-flex: 1;\n            -ms-flex: 1;\n            flex: 1;\n            line-height: 18px;\n            background: #fff;\n            color: #333;\n            font-size: 14px;\n            outline: 0;\n            margin-right: 5px;\n            border-radius: 5px;\n            padding: 7px;\n            padding-left: 32px;\n            -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n        }\n        .clear {\n            position: absolute;\n            right: 12px;\n            color: #999;\n        }\n     }\n    .quxiao {\n        position: absolute;\n        right: 8px;\n        top: 0%;\n        font-size: 16px;\n    }\n \n.bouncee-enter-active {\n        animation: bounce-in .3s;\n    }\n.bouncee-leave-active {\n        animation: bounce-in .1s reverse;\n    }\n@keyframes bounce-in {\n    0% {\n        transform: translate3d(100%,0,0)\n    }\n    \n    100% {\n        transform: translate3d(0,0,0)\n    }\n} \n",{"version":3,"sources":["Home.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmSA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"Home.vue","sourceRoot":"src/views","sourcesContent":["<template>\n    <div class=\"home page-tab\">\n        <div class=\"header\">\n            <van-row>\n                <div @click=\"cityClick\" >\n                <van-col span=\"5\" class=\"city\">{{city}} ▼</van-col>\n                </div>\n                <van-col span=\"19\" >\n                    <div class=\"search-box\" ref=\"searchBox\">\n                        <van-icon name=\"search\" class=\"icon\"/>\n                        <input ref=\"input\"  @focus=\"focus\"  class=\"box\" v-model=\"value\" type=\"text\" placeholder=\"请输入搜索关键词\">\n                        <van-icon name=\"clear\" @click=\"value=''\"  v-show=\"value\" class=\"clear\"/>\n                    </div>\n                    <transition name=\"bouncee\">\n                        <div class=\"quxiao\" v-show=\"query\" @click=\"closeSearch\">取消</div>\n                    </transition>\n                </van-col>\n            </van-row>\n        </div>\n    <div v-show=\"!showFlag\"  class=\"content\" @touchmove.prevent='touchmove' @touchstart.prevent='touchstart' @touchend.prevent='touchend'>\n        <Scroll v-if=\"recommend\" :pullup='true' @scrollToEnd='scrollToEnd2' :listenScroll='true' @scroll='scroll' :probeType='probeType'  :data='recommend.hotGoods' class=\"content-scroll\" :bounce='bounce' ref=\"scroll\">\n            <div>\n                <HomeSwiper :slides='recommend.slides'/>\n                <HomePanl :category='recommend.category' @item='item' :advertesPicture='recommend.advertesPicture.PICTURE_ADDRESS'/>\n                <HomeRecommend :recommend='recommend.recommend'/>\n                <HomeFoor :floorName='floorName.floor1' :foor1='recommend.floor1' :num='num'/>\n                <HomeFoor :floorName='floorName.floor2' :foor1='recommend.floor2' :num='num+1'/>\n                <HomeFoor :floorName='floorName.floor3' :foor1='recommend.floor3' :num='num+2'/> \n                <HomeHot :hot='recommend.hotGoods'/>\n            </div>\n        </Scroll>\n        <dir v-show=\"touch.init\">\n         <BaseRefresh :opacity='opac' :transformY='transformY' :rotate='rotate' :isRotate='isRotate' :trans='trans'/>\n\n        </dir>\n     </div>\n        <!-- <BaseLoding :showFlag='showFlag'/> -->\n        <HomeSearch v-show=\"query\" @scrollToEnd='scrollToEnd' :list='dataArr' @details='searchDetails' :len='len' :value='value' @vals='vals'/>\n        <div v-show=\"searchLoading\" class=\"van-loading van-loading--circular van-loading--white\" style=\"color: white;z-index:999\"><span class=\"van-loading__spinner van-loading__spinner--circular\"><svg viewBox=\"25 25 50 50\" class=\"van-loading__circular\"><circle cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\"></circle></svg></span></div>\n        <BaseFooter active='0'/>\n        <router-view/>\n</div>\n\n\n</template>\n\n<script>\nimport HomeRecommend from '@/components/home/HomeRecommend'\nimport HomeFoor from '@/components/home/HomeFoor'\nimport HomeHot from '@/components/home/HomeHot'\nimport HomeSearch from '@/components/home/HomeSearch'\nimport HomeSwiper from '@/components/home/HomeSwiper'\nimport HomePanl from '@/components/home/HomePanl'\nimport Scroll from 'public/Scroll'\nimport BaseFooter from 'public/BaseFooter'\nimport BaseRefresh from '@/components/home/BaseRefresh'\nimport {vuexData,page} from 'js/mixin'\nimport {throttle} from 'js/util'\nexport default {\n    name: \"Home\",\n    mixins: [page,vuexData],\n    data() {\n        return {\n            value: '',\n            recommend: '',\n            num: 1,\n            bounce: {\n                top:false,\n            },\n            probeType: 3,\n            floorName: '',\n            touch: {},\n            transformY: 0,\n            rotate: 0,\n            isRotate: false,\n            trans: false,\n            opac: 0,\n            currentCity: '',\n            query: false,       // 显示搜索\n            len: false,        // 是否含有搜索结果\n            page: 1,\n            searchLoading: false,\n        }\n    },\n    \n    components: {\n        HomeRecommend,\n        HomeFoor,\n        HomeSearch,\n        HomeHot,\n        Scroll,\n        BaseRefresh,\n        HomeSwiper,\n        HomePanl,\n        BaseFooter,\n    },\n    methods: {\n        scroll(e) {\n            Math.abs(e.y) == 0 ? this.touch.scroll = true : this.touch.scroll = false\n            if (this.transformY > 0) {\n                this.$refs.scroll.disable()\n            }\n        },\n        \n        touchstart(e) {\n            this.isRotate = false\n            this.trans = false\n            this.touch.init = true\n            this.touch.startY = e.touches[0].pageY        //第一次点击的位置\n        },\n        touchmove(e) {\n            if (!this.touch.scroll || !this.touch.init || e.touches[0].pageY > window.innerHeight) return\n            let pageY = e.touches[0].pageY\n            let daltaY = pageY -  this.touch.startY   //滑动的位置\n            this.transformY = Math.max(0, daltaY / 3.5)\n            this.rotate = Math.max(0,Math.min(360,daltaY) ) \n            if (this.transformY > 80 ) this.touch.isRotate = true\n            this.opac = daltaY / 320\n        },\n        async touchend(e) {\n            this.$refs.scroll.enable()\n            if (this.transformY > 0) this.trans = true\n            this.isRotate = true\n            if (!this.touch.isRotate ) {\n                 this.transformY = 0\n                 this.isRotate = false\n                 setTimeout(() => {\n                     this.opac = 0\n                 }, 300);\n            } else {\n                this.touch.isRotate = false\n                if (this.transformY > 100) {\n                    // 请求接口刷新数据\n                    try {\n                        const {data} = await this.Api.recommend()\n                        if (data.code == 200) {\n                            const datas = data.data\n                            this.recommend = datas\n                            this.floorName = datas.floorName\n                            setTimeout(() => {\n                                this.transformY = 0\n                                this.rotate = 0\n                                \n                            }, 1000);\n                            setTimeout(() => {\n                                this.isRotate = false\n                                this.opac = 0\n                                this.$toast('刷新成功')\n                            }, 1500);\n                        }\n                    } catch (error) {\n                        this.$toast('刷新失败,网络错误')\n                    }\n                    \n                }  else {\n                    this.transformY = 0\n                    this.rotate = 0\n                    this.isRotate = false\n                }\n            }\n        },\n        details(val) {\n            let id = {\n                goodsId: val.goodsId\n            }\n            this.setGoodDetails(id)\n            this.$router.push({name:`Details`,query: {id:val.goodsId}})\n        },\n        \n        searchDetails(id) {\n            this.$refs.input.blur()\n            this.$router.push({name:`Details`,query: {id}})\n        },\n        cityClick() {\n            this.$router.push({name: 'City'})\n        },\n        async getHome() {\n            try {\n                this.showFlag = true\n                const {data} = await this.Api.recommend()\n                if (data.code == 200) {\n                    this.showFlag = false\n                    this.recommend = data.data\n                    this.floorName = data.data.floorName\n                    this.setTab(data.data.category)\n                }\n            } catch (error) {\n                this.showFlag = false\n                this.$toast('网络错误')\n            }\n        },\n        // 跳转到商品分类\n        item(val,index) {\n            const id = val.bxMallSubDto[0].mallSubId\n            this.$router.push({\n                name: `Category`,\n                params: {\n                    id,\n                    index,\n                    val\n                }\n            })\n        },\n        //搜索\n        async search(value,flag) {\n            try {\n                if (this.isLocked()) return // 必须等待上一次请求完成\n                this.locked()//开始请求之前锁住\n                this.searchLoading = true\n                this.len = false\n                const {data} = await this.Api.search(value,this.page)\n                if (data.code == 200) {\n                    this.setTotal(data.data.count)  // 总条数\n                    this.unLocked() // 解锁\n                    this.searchLoading = false\n                    if (flag) {\n                        this.setNewData(data.data.list)\n                    } else {\n                        this.dataArr = data.data.list\n                    }\n                    if (!this.dataArr.length) {\n                        this.len = true\n                    }\n                }\n            } catch (error) {\n                this.unLocked() // 解锁\n                this.len = false\n                this.$toast('网络错误')\n            }\n            \n        },\n        // 取消搜索\n        onCancel() {\n            this.value = ''\n            \n        },\n        focus(){\n            let width =  '85%'\n            this.tran(width)\n            this.query = true\n        },\n        closeSearch(){\n            let width =  '100%'\n            this.tran(width)\n            this.query = false\n            setTimeout(() => {\n                this.value = ''\n            }, 300);\n        },\n        tran(width) {\n            this.$refs.searchBox.style.width = width;\n            this.$refs.searchBox.style['transitionDuration'] = '.3s'\n        },\n        vals(val) {\n            this.value = val\n        } ,\n        scrollToEnd() {\n            if (this.dataArr.length >= 20) {\n                if (this.hasMore()) {\n                    this.page++\n                    this.search(this.value,true)\n                } else {\n                    this.$toast('没有很多数据了~~')\n                }\n            }\n        },\n        scrollToEnd2() {\n            this.$refs.scroll.refresh()\n        },\n    },\n    \n    created() {\n        this.getHome()\n        // 节流函数处理\n        this.$watch('value',throttle(() => {\n            this.dataArr = []\n            if (this.value) {\n                this.page = 1\n                this.search(this.value,false)\n            } \n        },800))\n    },\n    watch: {\n        city() {\n            this.getHome()\n        },\n        \n    }\n}\n</script>\n<style lang=\"less\" scoped>\n@color: #F2F2F2;\n\n.header {\n    line-height: 44px;\n    position: relative;\n    z-index: 10;\n    background: #eee;\n    .city {\n        text-align: center;\n        background: @color;\n        font-size: 12px;\n        position: relative;\n        max-width: 120px;\n        .icon {\n            transform: rotate(270deg);\n            position: absolute;\n            top: 35%;\n            right: -12%\n        }\n    }\n}\n.content {\n    position: fixed;\n    top: 44px;\n    left: 0;\n    right: 0;\n    bottom: 50px;\n    .content-scroll {\n        height: 100%;\n        overflow: hidden;\n    }\n    \n}\n     .search-box {\n         display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n        -ms-flex-align: center;\n        align-items: center;\n        -webkit-box-sizing: border-box;\n        box-sizing: border-box;\n        width: 100%;\n        height: 44px;\n        background: #eee;\n        position: relative;\n        .icon {\n            font-size: 16px;\n            color: #222;\n            position: absolute;\n            left: 10px;\n        }\n        .box {\n            -webkit-box-flex: 1;\n            -ms-flex: 1;\n            flex: 1;\n            line-height: 18px;\n            background: #fff;\n            color: #333;\n            font-size: 14px;\n            outline: 0;\n            margin-right: 5px;\n            border-radius: 5px;\n            padding: 7px;\n            padding-left: 32px;\n            -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n        }\n        .clear {\n            position: absolute;\n            right: 12px;\n            color: #999;\n        }\n     }\n    .quxiao {\n        position: absolute;\n        right: 8px;\n        top: 0%;\n        font-size: 16px;\n    }\n \n.bouncee-enter-active {\n        animation: bounce-in .3s;\n    }\n.bouncee-leave-active {\n        animation: bounce-in .1s reverse;\n    }\n@keyframes bounce-in {\n    0% {\n        transform: translate3d(100%,0,0)\n    }\n    \n    100% {\n        transform: translate3d(0,0,0)\n    }\n} \n</style>"]}]}